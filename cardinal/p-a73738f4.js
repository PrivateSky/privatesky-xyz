import{g as e}from"./p-1c0c10bb.js";import{a as n,c as t}from"./p-ceec60b1.js";function l(e){let n=this;Object.keys(e).forEach((function(t){n[t]=e[t]}))}function o(e,t,l,o){let i=this;Array.from(o.attributes).filter(e=>e.name.startsWith(l)).forEach(r=>{const c=r.name.split(l)[1],a=n(c),u=e?`${e}.${r.value}`:r.value,f=t.getChainValue(u);o.setAttribute(c,f),i[a]=t.getChainValue(u)})}function i(e,t,l,o){let i=this;Array.from(o.attributes).filter(e=>e.value.startsWith(l)).forEach(r=>{const c=r.value.split(l)[1],a=e?`${e}.${c}`:c,u=n(r.name);if(t.hasExpression(a))i[u]=t.evaluateExpression(a),t.onChangeExpressionChain(a,(function(){i[u]=t.evaluateExpression(a)}));else{const e=t.getChainValue(a);o.setAttribute(r.name,e),i[u]=e,t.onChange(a,(function(){i[u]=t.getChainValue(a)}))}})}function r(e,n){try{let t=this;if(t.rootModel){let l=e;return t.parentChain&&(l=`${t.parentChain}.${e}`),t.rootModel.setChainValue(l,n),!0}return!1}catch(t){console.error(t)}return!1}function c(n,t,l){if(n||!t)return l();let r,c,a,u=this,f=e(u);if(null!==f.getAttribute("data-view-model")&&"psk-for-each"===f.tagName.toLowerCase())return r=f.getAttribute("data-view-model"),a=r,u.__assignProperties.call(u,{rootModel:t,parentChain:a}),l();if(r=f.getAttribute("view-model"),a=r,null===r&&(c=null===f.getAttribute("name")||f.getAttribute("name").startsWith("@")?null:f.getAttribute("name"),null!==c||null===f.getAttribute("label")||f.getAttribute("label").startsWith("@")||(c=f.getAttribute("label").replace(/( |:|\/|\.|-)/g,"").toLowerCase()),a=c),!r&&!c)return i.call(u,a,t,"@",f,l),o.call(u,a,t,"view-model-",f,l),l();function s(e,n){u[e]=t.getChainValue(n),t.onChange(n,(function(){u[e]=t.getChainValue(n)}))}if(u.__assignProperties.call(u,{rootModel:t,parentChain:a}),r){let e=t.getChainValue(a);return e?(Object.keys(e).forEach(e=>{s(e,`${a}.${e}`)}),function(){const e=a+".value";if(!t.getChainValue(a)||t.getChainValue(e))return l();s("value",e)}(),l()):l()}return l()}function a(){return n=>{let{componentWillLoad:o}=n;n.componentWillLoad=function(){let n=this,i=e(n);return n.changeModel=r,n.__assignProperties=l,i.isConnected?0===i.getAttributeNames().filter(e=>"data-view-model"===e.toLowerCase()||e.toLowerCase().includes("view-model")||i.getAttribute(e).toLowerCase().startsWith("@")).length?o&&o.call(n):new Promise(e=>{var l;l=()=>{e(o&&o.call(n))},t("getModelEvent",{bubbles:!0,composed:!0,cancellable:!0,detail:{callback:function(e,t){c.apply(n,[e,t,l])}}},!0,i)}):o&&o.call(n)}}}export{a as B}