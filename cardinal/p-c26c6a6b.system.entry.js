System.register(["./p-e09b966b.system.js","./p-90e1ba03.system.js","./p-ca300ef6.system.js","./p-21908523.system.js","./p-324643a3.system.js","./p-ffb476cc.system.js"],(function(e){"use strict";var t,n,r,i,o,a;return{setters:[function(e){t=e.r;n=e.h;r=e.g},function(){},function(){},function(e){i=e.T},function(e){o=e.C},function(e){a=e.B}],execute:function(){function s(e,t){var n=require("swarm-engine").SSAppPowerCord;var r=new n(t.contentWindow);$$.swarmEngine.plug(e,r)}function p(e){return e}var d=function(){function e(){this.registry=[];if(typeof $$.flows==="undefined"){require("callflow").initialise()}if(typeof $$.swarms==="undefined"){var e=require("swarm-engine");e.initialise("wallet")}else{$$.swarmEngine.updateIdentity("wallet")}}e.prototype.addSSAppReference=function(e,t){console.log("registering ssapp",e,t);if(typeof this.registry[e]!=="undefined"&&this.registry[e]!==t){console.log("Replacing a reference.")}else{s(p(e),t)}this.registry[e]=t};e.prototype.removeSSAppReference=function(e){if(typeof this.registry[e]==="undefined"){return}delete this.registry[e];$$.swarmEngine.unplug(p(e))};e.prototype.getSSAppReference=function(e){return this.registry[e]};return e}();var c=new d;var f={getInstance:function(){return c}};var u=undefined&&undefined.__decorate||function(e,t,n,r){var i=arguments.length,o=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)if(a=e[s])o=(i<3?a(o):i>3?a(t,n,o):a(t,n))||o;return i>3&&o&&Object.defineProperty(t,n,o),o};var l="/apps";var h=e("psk_ssapp",function(){var e=function(){function e(e){t(this,e)}e.prototype.hasRelevantMatchParams=function(){return this.match&&this.match.params&&this.match.params.appName};e.prototype.loadApp=function(e){var t=this;if(this.hasRelevantMatchParams()){this.applicationName=this.match.params.appName}else{this.applicationName=this.appName}this.getAppSeed((function(n,r){if(n){throw n}t.seed=r;t.digestSeedHex=t.digestMessage(r);if(typeof e==="function"){e()}}))};e.prototype.componentShouldUpdate=function(e,t,n){if(e!==t&&n==="digestSeedHex"){window.document.removeEventListener(t,this.eventHandler);window.document.addEventListener(e,this.eventHandler);return true}return false};e.prototype.ssappEventHandler=function(e){var t=e.detail||{};var n=this.element.querySelector("iframe");if(t.query==="seed"){n.contentWindow.document.dispatchEvent(new CustomEvent(this.digestSeedHex,{detail:{seed:this.seed}}));return}if(t.status==="completed"){n.contentWindow.location.reload()}};e.prototype.componentDidLoad=function(){var e=this.element.querySelector("iframe");console.log("#### Trying to register ssapp reference");f.getInstance().addSSAppReference(this.applicationName,e);this.eventHandler=this.ssappEventHandler.bind(this);window.document.addEventListener(this.digestSeedHex,this.eventHandler)};e.prototype.getSWOnMessageHandler=function(){var e=this;if(this.onServiceWorkerMessageHandler){return this.onServiceWorkerMessageHandler}this.onServiceWorkerMessageHandler=function(t){if(!t.data||t.data.query!=="seed"){return}var n=t.data.identity;if(n===e.digestSeedHex){t.source.postMessage({seed:e.seed})}};return this.onServiceWorkerMessageHandler};e.prototype.connectedCallback=function(){navigator.serviceWorker.addEventListener("message",this.getSWOnMessageHandler())};e.prototype.disconnectedCallback=function(){navigator.serviceWorker.removeEventListener("message",this.getSWOnMessageHandler())};e.prototype.getManifest=function(e){fetch("/download/manifest").then((function(t){t.text().then((function(t){e(undefined,JSON.parse(t))})).catch((function(t){e(t)}))}))};e.prototype.getAppSeed=function(e){var t=this;this.getManifest((function(n,r){if(n){throw n}if(r.mounts){for(var i in r.mounts){if(i===l+"/"+t.applicationName){return e(undefined,r.mounts[i])}}}e(new Error("No seed for app "+t.applicationName))}))};e.prototype.componentWillLoad=function(){var e=this;return new Promise((function(t){e.loadApp(t)}))};e.prototype.digestMessage=function(e){var t=require("pskcrypto");var n=t.pskHash(e,"hex");return n};e.prototype.render=function(){var e=window.top.location.href;if(e[e.length-1]!=="/"){e+="/"}var t=e+"iframe/"+this.digestSeedHex;return n("iframe",{sandbox:"allow-scripts allow-same-origin allow-forms","landing-page":this.landingPath,frameborder:"0",style:{overflow:"hidden",height:"100%",width:"100%"},src:t})};Object.defineProperty(e.prototype,"element",{get:function(){return r(this)},enumerable:false,configurable:true});Object.defineProperty(e,"watchers",{get:function(){return{appName:["loadApp"],match:["loadApp"]}},enumerable:false,configurable:true});return e}();u([a()],e.prototype,"modelHandler",void 0);u([o(),i({isMandatory:true,description:["This property represents the name of the Self Sovereign Application that you want to run."],propertyType:"string"})],e.prototype,"appName",void 0);u([i({isMandatory:true,description:"This property represents the direct path that will be passed to the Iframe as the landing-page property.",propertyType:"string"})],e.prototype,"landingPath",void 0);return e}())}}}));