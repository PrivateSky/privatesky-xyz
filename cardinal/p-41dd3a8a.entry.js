import{r as n,h as t,g as e}from"./p-7cf930c5.js";import{C as r}from"./p-daa61edb.js";import"./p-bf6c63e3.js";import"./p-e54b1fb8.js";import{B as i}from"./p-6b6db862.js";function s(n){var t={};function e(n,t){this.count=n,this.dataCodewords=t,this.__defineGetter__("Count",(function(){return this.count})),this.__defineGetter__("DataCodewords",(function(){return this.dataCodewords}))}function r(n,t,e){this.ecCodewordsPerBlock=n,this.ecBlocks=e?new Array(t,e):new Array(t),this.__defineGetter__("ECCodewordsPerBlock",(function(){return this.ecCodewordsPerBlock})),this.__defineGetter__("TotalECCodewords",(function(){return this.ecCodewordsPerBlock*this.NumBlocks})),this.__defineGetter__("NumBlocks",(function(){for(var n=0,t=0;t<this.ecBlocks.length;t++)n+=this.ecBlocks[t].length;return n})),this.getECBlocks=function(){return this.ecBlocks}}function i(n,t,e,r,i,s){this.versionNumber=n,this.alignmentPatternCenters=t,this.ecBlocks=new Array(e,r,i,s);for(var a=0,h=e.ECCodewordsPerBlock,o=e.getECBlocks(),w=0;w<o.length;w++){var u=o[w];a+=u.Count*(u.DataCodewords+h)}this.totalCodewords=a,this.__defineGetter__("VersionNumber",(function(){return this.versionNumber})),this.__defineGetter__("AlignmentPatternCenters",(function(){return this.alignmentPatternCenters})),this.__defineGetter__("TotalCodewords",(function(){return this.totalCodewords})),this.__defineGetter__("DimensionForVersion",(function(){return 17+4*this.versionNumber})),this.buildFunctionPattern=function(){var n=this.DimensionForVersion,t=new A(n);t.setRegion(0,0,9,9),t.setRegion(n-8,0,8,9),t.setRegion(0,n-8,9,8);for(var e=this.alignmentPatternCenters.length,r=0;r<e;r++)for(var i=this.alignmentPatternCenters[r]-2,s=0;s<e;s++)0==r&&(0==s||s==e-1)||r==e-1&&0==s||t.setRegion(this.alignmentPatternCenters[s]-2,i,5,5);return t.setRegion(6,9,1,n-17),t.setRegion(9,6,n-17,1),this.versionNumber>6&&(t.setRegion(n-11,0,3,6),t.setRegion(0,n-11,6,3)),t},this.getECBlocksForLevel=function(n){return this.ecBlocks[n.ordinal()]}}function s(n,t,e,r,i,a,h,o,w){this.a11=n,this.a12=r,this.a13=h,this.a21=t,this.a22=i,this.a23=o,this.a31=e,this.a32=a,this.a33=w,this.transformPoints1=function(n){for(var t=n.length,e=this.a11,r=this.a12,i=this.a13,s=this.a21,a=this.a22,h=this.a23,o=this.a31,w=this.a32,u=this.a33,f=0;f<t;f+=2){var c=n[f],v=n[f+1],l=i*c+h*v+u;n[f]=(e*c+s*v+o)/l,n[f+1]=(r*c+a*v+w)/l}},this.transformPoints2=function(n,t){for(var e=n.length,r=0;r<e;r++){var i=n[r],s=t[r],a=this.a13*i+this.a23*s+this.a33;n[r]=(this.a11*i+this.a21*s+this.a31)/a,t[r]=(this.a12*i+this.a22*s+this.a32)/a}},this.buildAdjoint=function(){return new s(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)},this.times=function(n){return new s(this.a11*n.a11+this.a21*n.a12+this.a31*n.a13,this.a11*n.a21+this.a21*n.a22+this.a31*n.a23,this.a11*n.a31+this.a21*n.a32+this.a31*n.a33,this.a12*n.a11+this.a22*n.a12+this.a32*n.a13,this.a12*n.a21+this.a22*n.a22+this.a32*n.a23,this.a12*n.a31+this.a22*n.a32+this.a32*n.a33,this.a13*n.a11+this.a23*n.a12+this.a33*n.a13,this.a13*n.a21+this.a23*n.a22+this.a33*n.a23,this.a13*n.a31+this.a23*n.a32+this.a33*n.a33)}}function a(n,t){this.bits=n,this.points=t}function h(n){this.image=n,this.resultPointCallback=null,this.sizeOfBlackWhiteBlackRun=function(n,t,e,r){var i=Math.abs(r-t)>Math.abs(e-n);if(i){var s=n;n=t,t=s,s=e,e=r,r=s}for(var a=Math.abs(e-n),h=Math.abs(r-t),o=-a>>1,w=t<r?1:-1,u=n<e?1:-1,f=0,c=n,v=t;c!=e;c+=u){var l=i?v:c,d=i?c:v;if(1==f?this.image[l+d*M.width]&&f++:this.image[l+d*M.width]||f++,3==f){var y=c-n,A=v-t;return Math.sqrt(y*y+A*A)}if((o+=h)>0){if(v==r)break;v+=w,o-=a}}var m=e-n,g=r-t;return Math.sqrt(m*m+g*g)},this.sizeOfBlackWhiteBlackRunBothWays=function(n,t,e,r){var i=this.sizeOfBlackWhiteBlackRun(n,t,e,r),s=1,a=n-(e-n);a<0?(s=n/(n-a),a=0):a>=M.width&&(s=(M.width-1-n)/(a-n),a=M.width-1);var h=Math.floor(t-(r-t)*s);return s=1,h<0?(s=t/(t-h),h=0):h>=M.height&&(s=(M.height-1-t)/(h-t),h=M.height-1),a=Math.floor(n+(a-n)*s),(i+=this.sizeOfBlackWhiteBlackRun(n,t,a,h))-1},this.calculateModuleSizeOneWay=function(n,t){var e=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(n.X),Math.floor(n.Y),Math.floor(t.X),Math.floor(t.Y)),r=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(t.X),Math.floor(t.Y),Math.floor(n.X),Math.floor(n.Y));return isNaN(e)?r/7:isNaN(r)?e/7:(e+r)/14},this.calculateModuleSize=function(n,t,e){return(this.calculateModuleSizeOneWay(n,t)+this.calculateModuleSizeOneWay(n,e))/2},this.distance=function(n,t){var e=n.X-t.X,r=n.Y-t.Y;return Math.sqrt(e*e+r*r)},this.computeDimension=function(n,t,e,r){var i=7+(Math.round(this.distance(n,t)/r)+Math.round(this.distance(n,e)/r)>>1);switch(3&i){case 0:i++;break;case 2:i--;break;case 3:throw"Error"}return i},this.findAlignmentInRegion=function(n,t,e,r){var i=Math.floor(r*n),s=Math.max(0,t-i),a=Math.min(M.width-1,t+i);if(a-s<3*n)throw"Error";var h=Math.max(0,e-i),o=Math.min(M.height-1,e+i);return new T(this.image,s,h,a-s,o-h,n,this.resultPointCallback).find()},this.createTransform=function(n,t,e,r,i){var a,h,o,w,u=i-3.5;return null!=r?(a=r.X,h=r.Y,o=w=u-3):(a=t.X-n.X+e.X,h=t.Y-n.Y+e.Y,o=w=u),s.quadrilateralToQuadrilateral(3.5,3.5,u,3.5,o,w,3.5,u,n.X,n.Y,t.X,t.Y,a,h,e.X,e.Y)},this.sampleGrid=function(n,e,r){return t.sampleGrid3(n,r,e)},this.processFinderPatternInfo=function(n){var t=n.TopLeft,e=n.TopRight,r=n.BottomLeft,s=this.calculateModuleSize(t,e,r);if(s<1)throw"Error";var h=this.computeDimension(t,e,r,s),o=i.getProvisionalVersionForDimension(h),w=null;if(o.AlignmentPatternCenters.length>0)for(var u=e.Y-t.Y+r.Y,f=1-3/(o.DimensionForVersion-7),c=Math.floor(t.X+f*(e.X-t.X+r.X-t.X)),v=Math.floor(t.Y+f*(u-t.Y)),l=4;l<=16;l<<=1){w=this.findAlignmentInRegion(s,c,v,l);break}var d=this.createTransform(t,e,r,w,h);return new a(this.sampleGrid(this.image,d,h),null==w?new Array(r,t,e):new Array(r,t,e,w))},this.detect=function(){var n=(new x).findFinderPattern(this.image);return this.processFinderPatternInfo(n)}}t.checkAndNudgePoints=function(n,t){for(var e=M.width,r=M.height,i=!0,s=0;s<t.length&&i;s+=2){var a=Math.floor(t[s]),h=Math.floor(t[s+1]);if(a<-1||a>e||h<-1||h>r)throw"Error.checkAndNudgePoints ";i=!1,-1==a?(t[s]=0,i=!0):a==e&&(t[s]=e-1,i=!0),-1==h?(t[s+1]=0,i=!0):h==r&&(t[s+1]=r-1,i=!0)}for(i=!0,s=t.length-2;s>=0&&i;s-=2){if(a=Math.floor(t[s]),h=Math.floor(t[s+1]),a<-1||a>e||h<-1||h>r)throw"Error.checkAndNudgePoints ";i=!1,-1==a?(t[s]=0,i=!0):a==e&&(t[s]=e-1,i=!0),-1==h?(t[s+1]=0,i=!0):h==r&&(t[s+1]=r-1,i=!0)}},t.sampleGrid3=function(n,e,r){for(var i=new A(e),s=new Array(e<<1),a=0;a<e;a++){for(var h=s.length,o=a+.5,w=0;w<h;w+=2)s[w]=.5+(w>>1),s[w+1]=o;r.transformPoints1(s),t.checkAndNudgePoints(n,s);try{for(w=0;w<h;w+=2)n[Math.floor(s[w])+M.width*Math.floor(s[w+1])]&&i.set_Renamed(w>>1,a)}catch(n){throw"Error.checkAndNudgePoints"}}return i},t.sampleGridx=function(n,e,r,i,a,h,o,w,u,f,c,v,l,d,y,A,m,g){var p=s.quadrilateralToQuadrilateral(r,i,a,h,o,w,u,f,c,v,l,d,y,A,m,g);return t.sampleGrid3(n,e,p)},i.VERSION_DECODE_INFO=new Array(31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017),i.VERSIONS=new Array(new i(1,new Array,new r(7,new e(1,19)),new r(10,new e(1,16)),new r(13,new e(1,13)),new r(17,new e(1,9))),new i(2,new Array(6,18),new r(10,new e(1,34)),new r(16,new e(1,28)),new r(22,new e(1,22)),new r(28,new e(1,16))),new i(3,new Array(6,22),new r(15,new e(1,55)),new r(26,new e(1,44)),new r(18,new e(2,17)),new r(22,new e(2,13))),new i(4,new Array(6,26),new r(20,new e(1,80)),new r(18,new e(2,32)),new r(26,new e(2,24)),new r(16,new e(4,9))),new i(5,new Array(6,30),new r(26,new e(1,108)),new r(24,new e(2,43)),new r(18,new e(2,15),new e(2,16)),new r(22,new e(2,11),new e(2,12))),new i(6,new Array(6,34),new r(18,new e(2,68)),new r(16,new e(4,27)),new r(24,new e(4,19)),new r(28,new e(4,15))),new i(7,new Array(6,22,38),new r(20,new e(2,78)),new r(18,new e(4,31)),new r(18,new e(2,14),new e(4,15)),new r(26,new e(4,13),new e(1,14))),new i(8,new Array(6,24,42),new r(24,new e(2,97)),new r(22,new e(2,38),new e(2,39)),new r(22,new e(4,18),new e(2,19)),new r(26,new e(4,14),new e(2,15))),new i(9,new Array(6,26,46),new r(30,new e(2,116)),new r(22,new e(3,36),new e(2,37)),new r(20,new e(4,16),new e(4,17)),new r(24,new e(4,12),new e(4,13))),new i(10,new Array(6,28,50),new r(18,new e(2,68),new e(2,69)),new r(26,new e(4,43),new e(1,44)),new r(24,new e(6,19),new e(2,20)),new r(28,new e(6,15),new e(2,16))),new i(11,new Array(6,30,54),new r(20,new e(4,81)),new r(30,new e(1,50),new e(4,51)),new r(28,new e(4,22),new e(4,23)),new r(24,new e(3,12),new e(8,13))),new i(12,new Array(6,32,58),new r(24,new e(2,92),new e(2,93)),new r(22,new e(6,36),new e(2,37)),new r(26,new e(4,20),new e(6,21)),new r(28,new e(7,14),new e(4,15))),new i(13,new Array(6,34,62),new r(26,new e(4,107)),new r(22,new e(8,37),new e(1,38)),new r(24,new e(8,20),new e(4,21)),new r(22,new e(12,11),new e(4,12))),new i(14,new Array(6,26,46,66),new r(30,new e(3,115),new e(1,116)),new r(24,new e(4,40),new e(5,41)),new r(20,new e(11,16),new e(5,17)),new r(24,new e(11,12),new e(5,13))),new i(15,new Array(6,26,48,70),new r(22,new e(5,87),new e(1,88)),new r(24,new e(5,41),new e(5,42)),new r(30,new e(5,24),new e(7,25)),new r(24,new e(11,12),new e(7,13))),new i(16,new Array(6,26,50,74),new r(24,new e(5,98),new e(1,99)),new r(28,new e(7,45),new e(3,46)),new r(24,new e(15,19),new e(2,20)),new r(30,new e(3,15),new e(13,16))),new i(17,new Array(6,30,54,78),new r(28,new e(1,107),new e(5,108)),new r(28,new e(10,46),new e(1,47)),new r(28,new e(1,22),new e(15,23)),new r(28,new e(2,14),new e(17,15))),new i(18,new Array(6,30,56,82),new r(30,new e(5,120),new e(1,121)),new r(26,new e(9,43),new e(4,44)),new r(28,new e(17,22),new e(1,23)),new r(28,new e(2,14),new e(19,15))),new i(19,new Array(6,30,58,86),new r(28,new e(3,113),new e(4,114)),new r(26,new e(3,44),new e(11,45)),new r(26,new e(17,21),new e(4,22)),new r(26,new e(9,13),new e(16,14))),new i(20,new Array(6,34,62,90),new r(28,new e(3,107),new e(5,108)),new r(26,new e(3,41),new e(13,42)),new r(30,new e(15,24),new e(5,25)),new r(28,new e(15,15),new e(10,16))),new i(21,new Array(6,28,50,72,94),new r(28,new e(4,116),new e(4,117)),new r(26,new e(17,42)),new r(28,new e(17,22),new e(6,23)),new r(30,new e(19,16),new e(6,17))),new i(22,new Array(6,26,50,74,98),new r(28,new e(2,111),new e(7,112)),new r(28,new e(17,46)),new r(30,new e(7,24),new e(16,25)),new r(24,new e(34,13))),new i(23,new Array(6,30,54,74,102),new r(30,new e(4,121),new e(5,122)),new r(28,new e(4,47),new e(14,48)),new r(30,new e(11,24),new e(14,25)),new r(30,new e(16,15),new e(14,16))),new i(24,new Array(6,28,54,80,106),new r(30,new e(6,117),new e(4,118)),new r(28,new e(6,45),new e(14,46)),new r(30,new e(11,24),new e(16,25)),new r(30,new e(30,16),new e(2,17))),new i(25,new Array(6,32,58,84,110),new r(26,new e(8,106),new e(4,107)),new r(28,new e(8,47),new e(13,48)),new r(30,new e(7,24),new e(22,25)),new r(30,new e(22,15),new e(13,16))),new i(26,new Array(6,30,58,86,114),new r(28,new e(10,114),new e(2,115)),new r(28,new e(19,46),new e(4,47)),new r(28,new e(28,22),new e(6,23)),new r(30,new e(33,16),new e(4,17))),new i(27,new Array(6,34,62,90,118),new r(30,new e(8,122),new e(4,123)),new r(28,new e(22,45),new e(3,46)),new r(30,new e(8,23),new e(26,24)),new r(30,new e(12,15),new e(28,16))),new i(28,new Array(6,26,50,74,98,122),new r(30,new e(3,117),new e(10,118)),new r(28,new e(3,45),new e(23,46)),new r(30,new e(4,24),new e(31,25)),new r(30,new e(11,15),new e(31,16))),new i(29,new Array(6,30,54,78,102,126),new r(30,new e(7,116),new e(7,117)),new r(28,new e(21,45),new e(7,46)),new r(30,new e(1,23),new e(37,24)),new r(30,new e(19,15),new e(26,16))),new i(30,new Array(6,26,52,78,104,130),new r(30,new e(5,115),new e(10,116)),new r(28,new e(19,47),new e(10,48)),new r(30,new e(15,24),new e(25,25)),new r(30,new e(23,15),new e(25,16))),new i(31,new Array(6,30,56,82,108,134),new r(30,new e(13,115),new e(3,116)),new r(28,new e(2,46),new e(29,47)),new r(30,new e(42,24),new e(1,25)),new r(30,new e(23,15),new e(28,16))),new i(32,new Array(6,34,60,86,112,138),new r(30,new e(17,115)),new r(28,new e(10,46),new e(23,47)),new r(30,new e(10,24),new e(35,25)),new r(30,new e(19,15),new e(35,16))),new i(33,new Array(6,30,58,86,114,142),new r(30,new e(17,115),new e(1,116)),new r(28,new e(14,46),new e(21,47)),new r(30,new e(29,24),new e(19,25)),new r(30,new e(11,15),new e(46,16))),new i(34,new Array(6,34,62,90,118,146),new r(30,new e(13,115),new e(6,116)),new r(28,new e(14,46),new e(23,47)),new r(30,new e(44,24),new e(7,25)),new r(30,new e(59,16),new e(1,17))),new i(35,new Array(6,30,54,78,102,126,150),new r(30,new e(12,121),new e(7,122)),new r(28,new e(12,47),new e(26,48)),new r(30,new e(39,24),new e(14,25)),new r(30,new e(22,15),new e(41,16))),new i(36,new Array(6,24,50,76,102,128,154),new r(30,new e(6,121),new e(14,122)),new r(28,new e(6,47),new e(34,48)),new r(30,new e(46,24),new e(10,25)),new r(30,new e(2,15),new e(64,16))),new i(37,new Array(6,28,54,80,106,132,158),new r(30,new e(17,122),new e(4,123)),new r(28,new e(29,46),new e(14,47)),new r(30,new e(49,24),new e(10,25)),new r(30,new e(24,15),new e(46,16))),new i(38,new Array(6,32,58,84,110,136,162),new r(30,new e(4,122),new e(18,123)),new r(28,new e(13,46),new e(32,47)),new r(30,new e(48,24),new e(14,25)),new r(30,new e(42,15),new e(32,16))),new i(39,new Array(6,26,54,82,110,138,166),new r(30,new e(20,117),new e(4,118)),new r(28,new e(40,47),new e(7,48)),new r(30,new e(43,24),new e(22,25)),new r(30,new e(10,15),new e(67,16))),new i(40,new Array(6,30,58,86,114,142,170),new r(30,new e(19,118),new e(6,119)),new r(28,new e(18,47),new e(31,48)),new r(30,new e(34,24),new e(34,25)),new r(30,new e(20,15),new e(61,16)))),i.getVersionForNumber=function(n){if(n<1||n>40)throw"ArgumentException";return i.VERSIONS[n-1]},i.getProvisionalVersionForDimension=function(n){if(n%4!=1)throw"Error getProvisionalVersionForDimension";try{return i.getVersionForNumber(n-17>>2)}catch(n){throw"Error getVersionForNumber"}},i.decodeVersionInformation=function(n){for(var t=4294967295,e=0,r=0;r<i.VERSION_DECODE_INFO.length;r++){var s=i.VERSION_DECODE_INFO[r];if(s==n)return this.getVersionForNumber(r+7);var a=u.numBitsDiffering(n,s);a<t&&(e=r+7,t=a)}return t<=3?this.getVersionForNumber(e):null},s.quadrilateralToQuadrilateral=function(n,t,e,r,i,s,a,h,o,w,u,f,c,v,l,d){var y=this.quadrilateralToSquare(n,t,e,r,i,s,a,h);return this.squareToQuadrilateral(o,w,u,f,c,v,l,d).times(y)},s.squareToQuadrilateral=function(n,t,e,r,i,a,h,o){var w=o-a,u=t-r+a-o;if(0==w&&0==u)return new s(e-n,i-e,n,r-t,a-r,t,0,0,1);var f=e-i,c=h-i,v=n-e+i-h,l=r-a,d=f*w-c*l,y=(v*w-c*u)/d,A=(f*u-v*l)/d;return new s(e-n+y*e,h-n+A*h,n,r-t+y*r,o-t+A*o,t,y,A,1)},s.quadrilateralToSquare=function(n,t,e,r,i,s,a,h){return this.squareToQuadrilateral(n,t,e,r,i,s,a,h).buildAdjoint()};var o=new Array(new Array(21522,0),new Array(20773,1),new Array(24188,2),new Array(23371,3),new Array(17913,4),new Array(16590,5),new Array(20375,6),new Array(19104,7),new Array(30660,8),new Array(29427,9),new Array(32170,10),new Array(30877,11),new Array(26159,12),new Array(25368,13),new Array(27713,14),new Array(26998,15),new Array(5769,16),new Array(5054,17),new Array(7399,18),new Array(6608,19),new Array(1890,20),new Array(597,21),new Array(3340,22),new Array(2107,23),new Array(13663,24),new Array(12392,25),new Array(16177,26),new Array(14854,27),new Array(9396,28),new Array(8579,29),new Array(11994,30),new Array(11245,31)),w=new Array(0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,4);function u(n){this.errorCorrectionLevel=f.forBits(n>>3&3),this.dataMask=7&n,this.__defineGetter__("ErrorCorrectionLevel",(function(){return this.errorCorrectionLevel})),this.__defineGetter__("DataMask",(function(){return this.dataMask})),this.GetHashCode=function(){return this.errorCorrectionLevel.ordinal()<<3|this.dataMask},this.Equals=function(n){return this.errorCorrectionLevel==n.errorCorrectionLevel&&this.dataMask==n.dataMask}}function f(n,t,e){this.ordinal_Renamed_Field=n,this.bits=t,this.name=e,this.__defineGetter__("Bits",(function(){return this.bits})),this.__defineGetter__("Name",(function(){return this.name})),this.ordinal=function(){return this.ordinal_Renamed_Field}}u.numBitsDiffering=function(n,t){return w[15&(n^=t)]+w[15&k(n,4)]+w[15&k(n,8)]+w[15&k(n,12)]+w[15&k(n,16)]+w[15&k(n,20)]+w[15&k(n,24)]+w[15&k(n,28)]},u.decodeFormatInformation=function(n){var t=u.doDecodeFormatInformation(n);return null!=t?t:u.doDecodeFormatInformation(21522^n)},u.doDecodeFormatInformation=function(n){for(var t=4294967295,e=0,r=0;r<o.length;r++){var i=o[r],s=i[0];if(s==n)return new u(i[1]);var a=this.numBitsDiffering(n,s);a<t&&(e=i[1],t=a)}return t<=3?new u(e):null},f.forBits=function(n){if(n<0||n>=y.length)throw"ArgumentException";return y[n]};var c=new f(0,1,"L"),v=new f(1,0,"M"),l=new f(2,3,"Q"),d=new f(3,2,"H"),y=new Array(v,c,d,l);function A(n,t){if(t||(t=n),n<1||t<1)throw"Both dimensions must be greater than 0";this.width=n,this.height=t;var e=n>>5;0!=(31&n)&&e++,this.rowSize=e,this.bits=new Array(e*t);for(var r=0;r<this.bits.length;r++)this.bits[r]=0;this.__defineGetter__("Width",(function(){return this.width})),this.__defineGetter__("Height",(function(){return this.height})),this.__defineGetter__("Dimension",(function(){if(this.width!=this.height)throw"Can't call getDimension() on a non-square matrix";return this.width})),this.get_Renamed=function(n,t){return 0!=(1&k(this.bits[t*this.rowSize+(n>>5)],31&n))},this.set_Renamed=function(n,t){this.bits[t*this.rowSize+(n>>5)]|=1<<(31&n)},this.flip=function(n,t){this.bits[t*this.rowSize+(n>>5)]^=1<<(31&n)},this.clear=function(){for(var n=this.bits.length,t=0;t<n;t++)this.bits[t]=0},this.setRegion=function(n,t,e,r){if(t<0||n<0)throw"Left and top must be nonnegative";if(r<1||e<1)throw"Height and width must be at least 1";var i=n+e,s=t+r;if(s>this.height||i>this.width)throw"The region must fit inside the matrix";for(var a=t;a<s;a++)for(var h=a*this.rowSize,o=n;o<i;o++)this.bits[h+(o>>5)]|=1<<(31&o)}}function m(n,t){this.numDataCodewords=n,this.codewords=t,this.__defineGetter__("NumDataCodewords",(function(){return this.numDataCodewords})),this.__defineGetter__("Codewords",(function(){return this.codewords}))}function g(n){var t=n.Dimension;if(t<21||1!=(3&t))throw"Error BitMatrixParser";this.bitMatrix=n,this.parsedVersion=null,this.parsedFormatInfo=null,this.copyBit=function(n,t,e){return this.bitMatrix.get_Renamed(n,t)?e<<1|1:e<<1},this.readFormatInformation=function(){if(null!=this.parsedFormatInfo)return this.parsedFormatInfo;for(var n=0,t=0;t<6;t++)n=this.copyBit(t,8,n);n=this.copyBit(7,8,n),n=this.copyBit(8,8,n),n=this.copyBit(8,7,n);for(var e=5;e>=0;e--)n=this.copyBit(8,e,n);if(this.parsedFormatInfo=u.decodeFormatInformation(n),null!=this.parsedFormatInfo)return this.parsedFormatInfo;var r=this.bitMatrix.Dimension;n=0;var i=r-8;for(t=r-1;t>=i;t--)n=this.copyBit(t,8,n);for(e=r-7;e<r;e++)n=this.copyBit(8,e,n);if(this.parsedFormatInfo=u.decodeFormatInformation(n),null!=this.parsedFormatInfo)return this.parsedFormatInfo;throw"Error readFormatInformation"},this.readVersion=function(){if(null!=this.parsedVersion)return this.parsedVersion;var n=this.bitMatrix.Dimension,t=n-17>>2;if(t<=6)return i.getVersionForNumber(t);for(var e=0,r=n-11,s=5;s>=0;s--)for(var a=n-9;a>=r;a--)e=this.copyBit(a,s,e);if(this.parsedVersion=i.decodeVersionInformation(e),null!=this.parsedVersion&&this.parsedVersion.DimensionForVersion==n)return this.parsedVersion;for(e=0,a=5;a>=0;a--)for(s=n-9;s>=r;s--)e=this.copyBit(a,s,e);if(this.parsedVersion=i.decodeVersionInformation(e),null!=this.parsedVersion&&this.parsedVersion.DimensionForVersion==n)return this.parsedVersion;throw"Error readVersion"},this.readCodewords=function(){var n=this.readFormatInformation(),t=this.readVersion(),e=p.forReference(n.DataMask),r=this.bitMatrix.Dimension;e.unmaskBitMatrix(this.bitMatrix,r);for(var i=t.buildFunctionPattern(),s=!0,a=new Array(t.TotalCodewords),h=0,o=0,w=0,u=r-1;u>0;u-=2){6==u&&u--;for(var f=0;f<r;f++)for(var c=s?r-1-f:f,v=0;v<2;v++)i.get_Renamed(u-v,c)||(w++,o<<=1,this.bitMatrix.get_Renamed(u-v,c)&&(o|=1),8==w&&(a[h++]=o,w=0,o=0));s^=!0}if(h!=t.TotalCodewords)throw"Error readCodewords";return a}}m.getDataBlocks=function(n,t,e){if(n.length!=t.TotalCodewords)throw"ArgumentException";for(var r=t.getECBlocksForLevel(e),i=0,s=r.getECBlocks(),a=0;a<s.length;a++)i+=s[a].Count;for(var h=new Array(i),o=0,w=0;w<s.length;w++){var u=s[w];for(a=0;a<u.Count;a++){var f=u.DataCodewords;h[o++]=new m(f,new Array(r.ECCodewordsPerBlock+f))}}for(var c=h[0].codewords.length,v=h.length-1;v>=0&&h[v].codewords.length!=c;)v--;v++;var l=c-r.ECCodewordsPerBlock,d=0;for(a=0;a<l;a++)for(w=0;w<o;w++)h[w].codewords[a]=n[d++];for(w=v;w<o;w++)h[w].codewords[l]=n[d++];var y=h[0].codewords.length;for(a=l;a<y;a++)for(w=0;w<o;w++)h[w].codewords[w<v?a:a+1]=n[d++];return h};var p={};function _(n,t){if(null==t||0==t.length)throw"System.ArgumentException";this.field=n;var e=t.length;if(e>1&&0==t[0]){for(var r=1;r<e&&0==t[r];)r++;if(r==e)this.coefficients=n.Zero.coefficients;else{this.coefficients=new Array(e-r);for(var i=0;i<this.coefficients.length;i++)this.coefficients[i]=0;for(var s=0;s<this.coefficients.length;s++)this.coefficients[s]=t[r+s]}}else this.coefficients=t;this.__defineGetter__("Zero",(function(){return 0==this.coefficients[0]})),this.__defineGetter__("Degree",(function(){return this.coefficients.length-1})),this.__defineGetter__("Coefficients",(function(){return this.coefficients})),this.getCoefficient=function(n){return this.coefficients[this.coefficients.length-1-n]},this.evaluateAt=function(n){if(0==n)return this.getCoefficient(0);var t=this.coefficients.length;if(1==n){for(var e=0,r=0;r<t;r++)e=b.addOrSubtract(e,this.coefficients[r]);return e}var i=this.coefficients[0];for(r=1;r<t;r++)i=b.addOrSubtract(this.field.multiply(n,i),this.coefficients[r]);return i},this.addOrSubtract=function(t){if(this.field!=t.field)throw"GF256Polys do not have same GF256 field";if(this.Zero)return t;if(t.Zero)return this;var e=this.coefficients,r=t.coefficients;if(e.length>r.length){var i=e;e=r,r=i}for(var s=new Array(r.length),a=r.length-e.length,h=0;h<a;h++)s[h]=r[h];for(var o=a;o<r.length;o++)s[o]=b.addOrSubtract(e[o-a],r[o]);return new _(n,s)},this.multiply1=function(n){if(this.field!=n.field)throw"GF256Polys do not have same GF256 field";if(this.Zero||n.Zero)return this.field.Zero;for(var t=this.coefficients,e=t.length,r=n.coefficients,i=r.length,s=new Array(e+i-1),a=0;a<e;a++)for(var h=t[a],o=0;o<i;o++)s[a+o]=b.addOrSubtract(s[a+o],this.field.multiply(h,r[o]));return new _(this.field,s)},this.multiply2=function(n){if(0==n)return this.field.Zero;if(1==n)return this;for(var t=this.coefficients.length,e=new Array(t),r=0;r<t;r++)e[r]=this.field.multiply(this.coefficients[r],n);return new _(this.field,e)},this.multiplyByMonomial=function(n,t){if(n<0)throw"System.ArgumentException";if(0==t)return this.field.Zero;for(var e=this.coefficients.length,r=new Array(e+n),i=0;i<r.length;i++)r[i]=0;for(i=0;i<e;i++)r[i]=this.field.multiply(this.coefficients[i],t);return new _(this.field,r)},this.divide=function(n){if(this.field!=n.field)throw"GF256Polys do not have same GF256 field";if(n.Zero)throw"Divide by 0";for(var t=this.field.Zero,e=this,r=n.getCoefficient(n.Degree),i=this.field.inverse(r);e.Degree>=n.Degree&&!e.Zero;){var s=e.Degree-n.Degree,a=this.field.multiply(e.getCoefficient(e.Degree),i),h=n.multiplyByMonomial(s,a),o=this.field.buildMonomial(s,a);t=t.addOrSubtract(o),e=e.addOrSubtract(h)}return new Array(t,e)}}function b(n){this.expTable=new Array(256),this.logTable=new Array(256);for(var t=1,e=0;e<256;e++)this.expTable[e]=t,(t<<=1)>=256&&(t^=n);for(e=0;e<255;e++)this.logTable[this.expTable[e]]=e;var r=new Array(1);r[0]=0,this.zero=new _(this,new Array(r));var i=new Array(1);i[0]=1,this.one=new _(this,new Array(i)),this.__defineGetter__("Zero",(function(){return this.zero})),this.__defineGetter__("One",(function(){return this.one})),this.buildMonomial=function(n,t){if(n<0)throw"System.ArgumentException";if(0==t)return this.zero;for(var e=new Array(n+1),r=0;r<e.length;r++)e[r]=0;return e[0]=t,new _(this,e)},this.exp=function(n){return this.expTable[n]},this.log=function(n){if(0==n)throw"System.ArgumentException";return this.logTable[n]},this.inverse=function(n){if(0==n)throw"System.ArithmeticException";return this.expTable[255-this.logTable[n]]},this.multiply=function(n,t){return 0==n||0==t?0:1==n?t:1==t?n:this.expTable[(this.logTable[n]+this.logTable[t])%255]}}p.forReference=function(n){if(n<0||n>7)throw"System.ArgumentException";return p.DATA_MASKS[n]},p.DATA_MASKS=new Array(new function(){this.unmaskBitMatrix=function(n,t){for(var e=0;e<t;e++)for(var r=0;r<t;r++)this.isMasked(e,r)&&n.flip(r,e)},this.isMasked=function(n,t){return 0==(n+t&1)}},new function(){this.unmaskBitMatrix=function(n,t){for(var e=0;e<t;e++)for(var r=0;r<t;r++)this.isMasked(e,r)&&n.flip(r,e)},this.isMasked=function(n){return 0==(1&n)}},new function(){this.unmaskBitMatrix=function(n,t){for(var e=0;e<t;e++)for(var r=0;r<t;r++)this.isMasked(e,r)&&n.flip(r,e)},this.isMasked=function(n,t){return t%3==0}},new function(){this.unmaskBitMatrix=function(n,t){for(var e=0;e<t;e++)for(var r=0;r<t;r++)this.isMasked(e,r)&&n.flip(r,e)},this.isMasked=function(n,t){return(n+t)%3==0}},new function(){this.unmaskBitMatrix=function(n,t){for(var e=0;e<t;e++)for(var r=0;r<t;r++)this.isMasked(e,r)&&n.flip(r,e)},this.isMasked=function(n,t){return 0==(k(n,1)+t/3&1)}},new function(){this.unmaskBitMatrix=function(n,t){for(var e=0;e<t;e++)for(var r=0;r<t;r++)this.isMasked(e,r)&&n.flip(r,e)},this.isMasked=function(n,t){var e=n*t;return(1&e)+e%3==0}},new function(){this.unmaskBitMatrix=function(n,t){for(var e=0;e<t;e++)for(var r=0;r<t;r++)this.isMasked(e,r)&&n.flip(r,e)},this.isMasked=function(n,t){var e=n*t;return 0==((1&e)+e%3&1)}},new function(){this.unmaskBitMatrix=function(n,t){for(var e=0;e<t;e++)for(var r=0;r<t;r++)this.isMasked(e,r)&&n.flip(r,e)},this.isMasked=function(n,t){return 0==((n+t&1)+n*t%3&1)}}),b.QR_CODE_FIELD=new b(285),b.DATA_MATRIX_FIELD=new b(301),b.addOrSubtract=function(n,t){return n^t};var S={};S.rsDecoder=new function(n){this.field=n,this.decode=function(n,t){for(var e=new _(this.field,n),r=new Array(t),i=0;i<r.length;i++)r[i]=0;var s=!0;for(i=0;i<t;i++){var a=e.evaluateAt(this.field.exp(i));r[r.length-1-i]=a,0!=a&&(s=!1)}if(!s){var h=new _(this.field,r),o=this.runEuclideanAlgorithm(this.field.buildMonomial(t,1),h,t),w=o[1],u=this.findErrorLocations(o[0]),f=this.findErrorMagnitudes(w,u,!1);for(i=0;i<u.length;i++){var c=n.length-1-this.field.log(u[i]);if(c<0)throw"ReedSolomonException Bad error location";n[c]=b.addOrSubtract(n[c],f[i])}}},this.runEuclideanAlgorithm=function(n,t,e){if(n.Degree<t.Degree){var r=n;n=t,t=r}for(var i=n,s=t,a=this.field.One,h=this.field.Zero,o=this.field.Zero,w=this.field.One;s.Degree>=Math.floor(e/2);){var u=i,f=a,c=o;if(a=h,o=w,(i=s).Zero)throw"r_{i-1} was zero";s=u;for(var v=this.field.Zero,l=i.getCoefficient(i.Degree),d=this.field.inverse(l);s.Degree>=i.Degree&&!s.Zero;){var y=s.Degree-i.Degree,A=this.field.multiply(s.getCoefficient(s.Degree),d);v=v.addOrSubtract(this.field.buildMonomial(y,A)),s=s.addOrSubtract(i.multiplyByMonomial(y,A))}h=v.multiply1(a).addOrSubtract(f),w=v.multiply1(o).addOrSubtract(c)}var m=w.getCoefficient(0);if(0==m)throw"ReedSolomonException sigmaTilde(0) was zero";var g=this.field.inverse(m),p=w.multiply2(g),_=s.multiply2(g);return new Array(p,_)},this.findErrorLocations=function(n){var t=n.Degree;if(1==t)return new Array(n.getCoefficient(1));for(var e=new Array(t),r=0,i=1;i<256&&r<t;i++)0==n.evaluateAt(i)&&(e[r]=this.field.inverse(i),r++);if(r!=t)throw"Error locator degree does not match number of roots";return e},this.findErrorMagnitudes=function(n,t,e){for(var r=t.length,i=new Array(r),s=0;s<r;s++){for(var a=this.field.inverse(t[s]),h=1,o=0;o<r;o++)s!=o&&(h=this.field.multiply(h,b.addOrSubtract(1,this.field.multiply(t[o],a))));i[s]=this.field.multiply(n.evaluateAt(a),this.field.inverse(h)),e&&(i[s]=this.field.multiply(i[s],a))}return i}}(b.QR_CODE_FIELD),S.correctErrors=function(n,t){for(var e=n.length,r=new Array(e),i=0;i<e;i++)r[i]=255&n[i];var s=n.length-t;try{S.rsDecoder.decode(r,s)}catch(n){throw n}for(i=0;i<t;i++)n[i]=r[i]},S.decode=function(n){for(var t=new g(n),e=t.readVersion(),r=t.readFormatInformation().ErrorCorrectionLevel,i=t.readCodewords(),s=m.getDataBlocks(i,e,r),a=0,h=0;h<s.length;h++)a+=s[h].NumDataCodewords;for(var o=new Array(a),w=0,u=0;u<s.length;u++){var f=s[u],c=f.Codewords,v=f.NumDataCodewords;for(S.correctErrors(c,v),h=0;h<v;h++)o[w++]=c[h]}return new I(o,e.VersionNumber,r.Bits)};var M={};function k(n,t){return n>=0?n>>t:(n>>t)+(2<<~t)}function E(n,t,e){this.x=n,this.y=t,this.count=1,this.estimatedModuleSize=e,this.__defineGetter__("EstimatedModuleSize",(function(){return this.estimatedModuleSize})),this.__defineGetter__("Count",(function(){return this.count})),this.__defineGetter__("X",(function(){return this.x})),this.__defineGetter__("Y",(function(){return this.y})),this.incrementCount=function(){this.count++},this.aboutEquals=function(n,t,e){if(Math.abs(t-this.y)<=n&&Math.abs(e-this.x)<=n){var r=Math.abs(n-this.estimatedModuleSize);return r<=1||r/this.estimatedModuleSize<=1}return!1}}function N(n){this.bottomLeft=n[0],this.topLeft=n[1],this.topRight=n[2],this.__defineGetter__("BottomLeft",(function(){return this.bottomLeft})),this.__defineGetter__("TopLeft",(function(){return this.topLeft})),this.__defineGetter__("TopRight",(function(){return this.topRight}))}function x(){this.image=null,this.possibleCenters=[],this.hasSkipped=!1,this.crossCheckStateCount=new Array(0,0,0,0,0),this.resultPointCallback=null,this.__defineGetter__("CrossCheckStateCount",(function(){return this.crossCheckStateCount[0]=0,this.crossCheckStateCount[1]=0,this.crossCheckStateCount[2]=0,this.crossCheckStateCount[3]=0,this.crossCheckStateCount[4]=0,this.crossCheckStateCount})),this.foundPatternCross=function(n){for(var t=0,e=0;e<5;e++){var r=n[e];if(0==r)return!1;t+=r}if(t<7)return!1;var i=Math.floor((t<<8)/7),s=Math.floor(i/2);return Math.abs(i-(n[0]<<8))<s&&Math.abs(i-(n[1]<<8))<s&&Math.abs(3*i-(n[2]<<8))<3*s&&Math.abs(i-(n[3]<<8))<s&&Math.abs(i-(n[4]<<8))<s},this.centerFromEnd=function(n,t){return t-n[4]-n[3]-n[2]/2},this.crossCheckVertical=function(n,t,e,r){for(var i=this.image,s=M.height,a=this.CrossCheckStateCount,h=n;h>=0&&i[t+h*M.width];)a[2]++,h--;if(h<0)return NaN;for(;h>=0&&!i[t+h*M.width]&&a[1]<=e;)a[1]++,h--;if(h<0||a[1]>e)return NaN;for(;h>=0&&i[t+h*M.width]&&a[0]<=e;)a[0]++,h--;if(a[0]>e)return NaN;for(h=n+1;h<s&&i[t+h*M.width];)a[2]++,h++;if(h==s)return NaN;for(;h<s&&!i[t+h*M.width]&&a[3]<e;)a[3]++,h++;if(h==s||a[3]>=e)return NaN;for(;h<s&&i[t+h*M.width]&&a[4]<e;)a[4]++,h++;return a[4]>=e||5*Math.abs(a[0]+a[1]+a[2]+a[3]+a[4]-r)>=2*r?NaN:this.foundPatternCross(a)?this.centerFromEnd(a,h):NaN},this.crossCheckHorizontal=function(n,t,e,r){for(var i=this.image,s=M.width,a=this.CrossCheckStateCount,h=n;h>=0&&i[h+t*M.width];)a[2]++,h--;if(h<0)return NaN;for(;h>=0&&!i[h+t*M.width]&&a[1]<=e;)a[1]++,h--;if(h<0||a[1]>e)return NaN;for(;h>=0&&i[h+t*M.width]&&a[0]<=e;)a[0]++,h--;if(a[0]>e)return NaN;for(h=n+1;h<s&&i[h+t*M.width];)a[2]++,h++;if(h==s)return NaN;for(;h<s&&!i[h+t*M.width]&&a[3]<e;)a[3]++,h++;if(h==s||a[3]>=e)return NaN;for(;h<s&&i[h+t*M.width]&&a[4]<e;)a[4]++,h++;return a[4]>=e||5*Math.abs(a[0]+a[1]+a[2]+a[3]+a[4]-r)>=r?NaN:this.foundPatternCross(a)?this.centerFromEnd(a,h):NaN},this.handlePossibleCenter=function(n,t,e){var r=n[0]+n[1]+n[2]+n[3]+n[4],i=this.centerFromEnd(n,e),s=this.crossCheckVertical(t,Math.floor(i),n[2],r);if(!isNaN(s)&&(i=this.crossCheckHorizontal(Math.floor(i),Math.floor(s),n[2],r),!isNaN(i))){for(var a=r/7,h=!1,o=this.possibleCenters.length,w=0;w<o;w++){var u=this.possibleCenters[w];if(u.aboutEquals(a,s,i)){u.incrementCount(),h=!0;break}}if(!h){var f=new E(i,s,a);this.possibleCenters.push(f),null!=this.resultPointCallback&&this.resultPointCallback.foundPossibleResultPoint(f)}return!0}return!1},this.selectBestPatterns=function(){var n=this.possibleCenters.length;if(n<3)throw"Couldn't find enough finder patterns (found "+n+")";if(n>3){for(var t=0,e=0,r=0;r<n;r++){var i=this.possibleCenters[r].EstimatedModuleSize;t+=i,e+=i*i}var s=t/n;this.possibleCenters.sort((function(n,t){var e=Math.abs(t.EstimatedModuleSize-s),r=Math.abs(n.EstimatedModuleSize-s);return e<r?-1:e==r?0:1}));var a=Math.sqrt(e/n-s*s),h=Math.max(.2*s,a);for(r=this.possibleCenters.length-1;r>=0;r--)Math.abs(this.possibleCenters[r].EstimatedModuleSize-s)>h&&this.possibleCenters.splice(r,1)}return this.possibleCenters.length>3&&this.possibleCenters.sort((function(n,t){return n.count>t.count?-1:n.count<t.count?1:0})),new Array(this.possibleCenters[0],this.possibleCenters[1],this.possibleCenters[2])},this.findRowSkip=function(){var n=this.possibleCenters.length;if(n<=1)return 0;for(var t=null,e=0;e<n;e++){var r=this.possibleCenters[e];if(r.Count>=2){if(null!=t)return this.hasSkipped=!0,Math.floor((Math.abs(t.X-r.X)-Math.abs(t.Y-r.Y))/2);t=r}}return 0},this.haveMultiplyConfirmedCenters=function(){for(var n=0,t=0,e=this.possibleCenters.length,r=0;r<e;r++){var i=this.possibleCenters[r];i.Count>=2&&(n++,t+=i.EstimatedModuleSize)}if(n<3)return!1;var s=t/e,a=0;for(r=0;r<e;r++)i=this.possibleCenters[r],a+=Math.abs(i.EstimatedModuleSize-s);return a<=.05*t},this.findFinderPattern=function(n){this.image=n;var t=M.height,e=M.width,r=Math.floor(3*t/228);r<3&&(r=3);for(var i=!1,s=new Array(5),a=r-1;a<t&&!i;a+=r){s[0]=0,s[1]=0,s[2]=0,s[3]=0,s[4]=0;for(var h=0,o=0;o<e;o++)if(n[o+a*M.width])1==(1&h)&&h++,s[h]++;else if(0==(1&h))if(4==h)if(this.foundPatternCross(s)){if(this.handlePossibleCenter(s,a,o))if(r=2,this.hasSkipped)i=this.haveMultiplyConfirmedCenters();else{var w=this.findRowSkip();w>s[2]&&(a+=w-s[2]-r,o=e-1)}else{do{o++}while(o<e&&!n[o+a*M.width]);o--}h=0,s[0]=0,s[1]=0,s[2]=0,s[3]=0,s[4]=0}else s[0]=s[2],s[1]=s[3],s[2]=s[4],s[3]=1,s[4]=0,h=3;else s[++h]++;else s[h]++;this.foundPatternCross(s)&&this.handlePossibleCenter(s,a,e)&&(r=s[0],this.hasSkipped&&(i=this.haveMultiplyConfirmedCenters()))}var u=this.selectBestPatterns();return M.orderBestPatterns(u),new N(u)}}function C(n,t,e){this.x=n,this.y=t,this.count=1,this.estimatedModuleSize=e,this.__defineGetter__("EstimatedModuleSize",(function(){return this.estimatedModuleSize})),this.__defineGetter__("Count",(function(){return this.count})),this.__defineGetter__("X",(function(){return Math.floor(this.x)})),this.__defineGetter__("Y",(function(){return Math.floor(this.y)})),this.incrementCount=function(){this.count++},this.aboutEquals=function(n,t,e){if(Math.abs(t-this.y)<=n&&Math.abs(e-this.x)<=n){var r=Math.abs(n-this.estimatedModuleSize);return r<=1||r/this.estimatedModuleSize<=1}return!1}}function T(n,t,e,r,i,s,a){this.image=n,this.possibleCenters=new Array,this.startX=t,this.startY=e,this.width=r,this.height=i,this.moduleSize=s,this.crossCheckStateCount=new Array(0,0,0),this.resultPointCallback=a,this.centerFromEnd=function(n,t){return t-n[2]-n[1]/2},this.foundPatternCross=function(n){for(var t=this.moduleSize,e=t/2,r=0;r<3;r++)if(Math.abs(t-n[r])>=e)return!1;return!0},this.crossCheckVertical=function(n,t,e,r){var i=this.image,s=M.height,a=this.crossCheckStateCount;a[0]=0,a[1]=0,a[2]=0;for(var h=n;h>=0&&i[t+h*M.width]&&a[1]<=e;)a[1]++,h--;if(h<0||a[1]>e)return NaN;for(;h>=0&&!i[t+h*M.width]&&a[0]<=e;)a[0]++,h--;if(a[0]>e)return NaN;for(h=n+1;h<s&&i[t+h*M.width]&&a[1]<=e;)a[1]++,h++;if(h==s||a[1]>e)return NaN;for(;h<s&&!i[t+h*M.width]&&a[2]<=e;)a[2]++,h++;return a[2]>e||5*Math.abs(a[0]+a[1]+a[2]-r)>=2*r?NaN:this.foundPatternCross(a)?this.centerFromEnd(a,h):NaN},this.handlePossibleCenter=function(n,t,e){var r=n[0]+n[1]+n[2],i=this.centerFromEnd(n,e),s=this.crossCheckVertical(t,Math.floor(i),2*n[1],r);if(!isNaN(s)){for(var a=(n[0]+n[1]+n[2])/3,h=this.possibleCenters.length,o=0;o<h;o++)if(this.possibleCenters[o].aboutEquals(a,s,i))return new C(i,s,a);var w=new C(i,s,a);this.possibleCenters.push(w),null!=this.resultPointCallback&&this.resultPointCallback.foundPossibleResultPoint(w)}return null},this.find=function(){for(var t=this.startX,i=this.height,s=t+r,a=e+(i>>1),h=new Array(0,0,0),o=0;o<i;o++){var w=a+(0==(1&o)?o+1>>1:-(o+1>>1));h[0]=0,h[1]=0,h[2]=0;for(var u=t;u<s&&!n[u+M.width*w];)u++;for(var f=0;u<s;){if(n[u+w*M.width])if(1==f)h[f]++;else if(2==f){var c;if(this.foundPatternCross(h)&&null!=(c=this.handlePossibleCenter(h,w,u)))return c;h[0]=h[2],h[1]=1,h[2]=0,f=1}else h[++f]++;else 1==f&&f++,h[f]++;u++}if(this.foundPatternCross(h)&&null!=(c=this.handlePossibleCenter(h,w,s)))return c}if(0!=this.possibleCenters.length)return this.possibleCenters[0];throw"Couldn't find enough alignment patterns"}}function I(n,t,e){this.blockPointer=0,this.bitPointer=7,this.dataLength=0,this.blocks=n,this.numErrorCorrectionCode=e,t<=9?this.dataLengthMode=0:t>=10&&t<=26?this.dataLengthMode=1:t>=27&&t<=40&&(this.dataLengthMode=2),this.getNextBits=function(n){var t=0;if(n<this.bitPointer+1){for(var e=0,r=0;r<n;r++)e+=1<<r;return t=(this.blocks[this.blockPointer]&(e<<=this.bitPointer-n+1))>>this.bitPointer-n+1,this.bitPointer-=n,t}if(n<this.bitPointer+1+8){var i=0;for(r=0;r<this.bitPointer+1;r++)i+=1<<r;return t=(this.blocks[this.blockPointer]&i)<<n-(this.bitPointer+1),this.blockPointer++,t+=this.blocks[this.blockPointer]>>8-(n-(this.bitPointer+1)),this.bitPointer=this.bitPointer-n%8,this.bitPointer<0&&(this.bitPointer=8+this.bitPointer),t}if(n<this.bitPointer+1+16){i=0;var s=0;for(r=0;r<this.bitPointer+1;r++)i+=1<<r;var a=(this.blocks[this.blockPointer]&i)<<n-(this.bitPointer+1);this.blockPointer++;var h=this.blocks[this.blockPointer]<<n-(this.bitPointer+1+8);for(this.blockPointer++,r=0;r<n-(this.bitPointer+1+8);r++)s+=1<<r;return t=a+h+((this.blocks[this.blockPointer]&(s<<=8-(n-(this.bitPointer+1+8))))>>8-(n-(this.bitPointer+1+8))),this.bitPointer=this.bitPointer-(n-8)%8,this.bitPointer<0&&(this.bitPointer=8+this.bitPointer),t}return 0},this.NextMode=function(){return this.blockPointer>this.blocks.length-this.numErrorCorrectionCode-2?0:this.getNextBits(4)},this.getDataLength=function(n){for(var t=0;n>>t!=1;)t++;return this.getNextBits(M.sizeOfDataLengthInfo[this.dataLengthMode][t])},this.getRomanAndFigureString=function(n){var t=n,e=0,r="",i=new Array("0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":");do{if(t>1){var s=(e=this.getNextBits(11))%45;r+=i[Math.floor(e/45)],r+=i[s],t-=2}else 1==t&&(r+=i[e=this.getNextBits(6)],t-=1)}while(t>0);return r},this.getFigureString=function(n){var t=n,e=0,r="";do{t>=3?((e=this.getNextBits(10))<100&&(r+="0"),e<10&&(r+="0"),t-=3):2==t?((e=this.getNextBits(7))<10&&(r+="0"),t-=2):1==t&&(e=this.getNextBits(4),t-=1),r+=e}while(t>0);return r},this.get8bitByteArray=function(n){var t=n,e=0,r=new Array;do{e=this.getNextBits(8),r.push(e),t--}while(t>0);return r},this.getKanjiString=function(n){var t=n,e=0,r="";do{var i=((e=this.getNextBits(13))/192<<8)+e%192;r+=String.fromCharCode(i+33088<=40956?i+33088:i+49472),t--}while(t>0);return r},this.parseECIValue=function(){var n=0,t=this.getNextBits(8);return 0==(128&t)&&(n=127&t),128==(192&t)&&(n=(63&t)<<8|this.getNextBits(8)),192==(224&t)&&(n=(31&t)<<16|this.getNextBits(8)),n},this.__defineGetter__("DataByte",(function(){for(var n=new Array;;){var t=this.NextMode();if(0==t){if(n.length>0)break;throw"Empty data block"}if(1!=t&&2!=t&&4!=t&&8!=t&&7!=t)throw"Invalid mode: "+t+" in (block:"+this.blockPointer+" bit:"+this.bitPointer+")";if(7==t)var e=this.parseECIValue();else{var r=this.getDataLength(t);if(r<1)throw"Invalid data length: "+r;switch(t){case 1:for(var i=this.getFigureString(r),s=new Array(i.length),a=0;a<i.length;a++)s[a]=i.charCodeAt(a);n.push(s);break;case 2:for(i=this.getRomanAndFigureString(r),s=new Array(i.length),a=0;a<i.length;a++)s[a]=i.charCodeAt(a);n.push(s);break;case 4:e=this.get8bitByteArray(r),n.push(e);break;case 8:i=this.getKanjiString(r),n.push(i)}}}return n}))}return M.imagedata=null,M.width=0,M.height=0,M.qrCodeSymbol=null,M.debug=!1,M.maxImgSize=1048576,M.sizeOfDataLengthInfo=[[10,9,8,8],[12,11,16,10],[14,13,16,12]],M.callback=null,M.vidSuccess=function(n){M.localstream=n,M.webkit?M.video.src=window.webkitURL.createObjectURL(n):M.moz?(M.video.mozSrcObject=n,M.video.play()):M.video.src=n,M.gUM=!0,M.canvas_qr2=document.createElement("canvas"),M.canvas_qr2.id="qr-canvas",M.qrcontext2=M.canvas_qr2.getContext("2d"),M.canvas_qr2.width=M.video.videoWidth,M.canvas_qr2.height=M.video.videoHeight,setTimeout(M.captureToCanvas,500)},M.vidError=function(){M.gUM=!1},M.captureToCanvas=function(){if(M.gUM)try{if(0==M.video.videoWidth)return void setTimeout(M.captureToCanvas,500);M.canvas_qr2.width=M.video.videoWidth,M.canvas_qr2.height=M.video.videoHeight,M.qrcontext2.drawImage(M.video,0,0);try{M.decode()}catch(n){console.log(n),setTimeout(M.captureToCanvas,500)}}catch(n){console.log(n),setTimeout(M.captureToCanvas,500)}},M.setWebcam=function(t){var e=navigator;M.video=n.querySelector("#"+t);var r=!0;if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)try{navigator.mediaDevices.enumerateDevices().then((function(n){n.forEach((function(n){console.log("deb1"),"videoinput"===n.kind&&n.label.toLowerCase().search("back")>-1&&(r=[{sourceId:n.deviceId}]),console.log(n.kind+": "+n.label+" id = "+n.deviceId)}))}))}catch(t){console.log(t)}else console.log("no navigator.mediaDevices.enumerateDevices");e.getUserMedia?e.getUserMedia({video:r,audio:!1},M.vidSuccess,M.vidError):e.webkitGetUserMedia?(M.webkit=!0,e.webkitGetUserMedia({video:r,audio:!1},M.vidSuccess,M.vidError)):e.mozGetUserMedia&&(M.moz=!0,e.mozGetUserMedia({video:r,audio:!1},M.vidSuccess,M.vidError))},M.decode=function(t){if(0==arguments.length){if(M.canvas_qr2)var e=M.canvas_qr2,r=M.qrcontext2;else r=(e=n.querySelector("#qr-canvas")).getContext("2d");return M.width=e.width,M.height=e.height,M.imagedata=r.getImageData(0,0,M.width,M.height),M.result=M.process(r),null!=M.callback&&M.callback(M.result),M.result}var i=new Image;i.crossOrigin="Anonymous",i.onload=function(){var t=n.querySelector("#out-canvas");if(null!=t){var e=t.getContext("2d");e.clearRect(0,0,320,240),e.drawImage(i,0,0,320,240)}var r=document.createElement("canvas"),s=r.getContext("2d"),a=i.height,h=i.width;if(i.width*i.height>M.maxImgSize){var o=i.width/i.height;h=o*(a=Math.sqrt(M.maxImgSize/o))}r.width=h,r.height=a,s.drawImage(i,0,0,r.width,r.height),M.width=r.width,M.height=r.height;try{M.imagedata=s.getImageData(0,0,r.width,r.height)}catch(t){return M.result="Cross domain image reading not supported in your browser! Save it to your computer then drag and drop the file!",void(null!=M.callback&&M.callback(M.result))}try{M.result=M.process(s)}catch(t){console.log(t),M.result="error decoding QR Code"}null!=M.callback&&M.callback(M.result)},i.onerror=function(){null!=M.callback&&M.callback("Failed to load the image")},i.src=t},M.isUrl=function(n){return/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(n)},M.decode_url=function(n){var t="";try{t=escape(n)}catch(e){console.log(e),t=n}var e="";try{e=decodeURIComponent(t)}catch(n){console.log(n),e=t}return e},M.decode_utf8=function(n){return M.isUrl(n)?M.decode_url(n):n},M.process=function(n){var t=(new Date).getTime(),e=M.grayScaleToBitmap(M.grayscale());if(M.debug){for(var r=0;r<M.height;r++)for(var i=0;i<M.width;i++){var s=4*i+r*M.width*4;M.imagedata.data[s]=0,M.imagedata.data[s+1]=0,M.imagedata.data[s+2]=e[i+r*M.width]?255:0}n.putImageData(M.imagedata,0,0)}var a=new h(e).detect();if(M.debug){for(r=0;r<a.bits.Height;r++)for(i=0;i<a.bits.Width;i++)M.imagedata.data[s=4*i*2+2*r*M.width*4]=(a.bits.get_Renamed(i,r),0),M.imagedata.data[s+1]=(a.bits.get_Renamed(i,r),0),M.imagedata.data[s+2]=a.bits.get_Renamed(i,r)?255:0;n.putImageData(M.imagedata,0,0)}for(var o=S.decode(a.bits).DataByte,w="",u=0;u<o.length;u++)for(var f=0;f<o[u].length;f++)w+=String.fromCharCode(o[u][f]);var c=(new Date).getTime()-t;return console.log(c),M.decode_utf8(w)},M.getPixel=function(n,t){if(M.width<n)throw"point error";if(M.height<t)throw"point error";var e=4*n+t*M.width*4;return(33*M.imagedata.data[e]+34*M.imagedata.data[e+1]+33*M.imagedata.data[e+2])/100},M.binarize=function(n){for(var t=new Array(M.width*M.height),e=0;e<M.height;e++)for(var r=0;r<M.width;r++){var i=M.getPixel(r,e);t[r+e*M.width]=i<=n}return t},M.getMiddleBrightnessPerArea=function(n){for(var t=Math.floor(M.width/4),e=Math.floor(M.height/4),r=new Array(4),i=0;i<4;i++){r[i]=new Array(4);for(var s=0;s<4;s++)r[i][s]=new Array(0,0)}for(var a=0;a<4;a++)for(var h=0;h<4;h++){r[h][a][0]=255;for(var o=0;o<e;o++)for(var w=0;w<t;w++){var u=n[t*h+w+(e*a+o)*M.width];u<r[h][a][0]&&(r[h][a][0]=u),u>r[h][a][1]&&(r[h][a][1]=u)}}for(var f=new Array(4),c=0;c<4;c++)f[c]=new Array(4);for(a=0;a<4;a++)for(h=0;h<4;h++)f[h][a]=Math.floor((r[h][a][0]+r[h][a][1])/2);return f},M.grayScaleToBitmap=function(n){for(var t=M.getMiddleBrightnessPerArea(n),e=t.length,r=Math.floor(M.width/e),i=Math.floor(M.height/e),s=new ArrayBuffer(M.width*M.height),a=new Uint8Array(s),h=0;h<e;h++)for(var o=0;o<e;o++)for(var w=0;w<i;w++)for(var u=0;u<r;u++)a[r*o+u+(i*h+w)*M.width]=n[r*o+u+(i*h+w)*M.width]<t[o][h];return a},M.grayscale=function(){for(var n=new ArrayBuffer(M.width*M.height),t=new Uint8Array(n),e=0;e<M.height;e++)for(var r=0;r<M.width;r++){var i=M.getPixel(r,e);t[r+e*M.width]=i}return t},M.orderBestPatterns=function(n){function t(n,t){var e=n.X-t.X,r=n.Y-t.Y;return Math.sqrt(e*e+r*r)}var e,r,i,s=t(n[0],n[1]),a=t(n[1],n[2]),h=t(n[0],n[2]);if(a>=s&&a>=h?(r=n[0],e=n[1],i=n[2]):h>=a&&h>=s?(r=n[1],e=n[0],i=n[2]):(r=n[2],e=n[0],i=n[1]),function(n,t,e){var r=t.x,i=t.y;return(e.x-r)*(n.y-i)-(e.y-i)*(n.x-r)}(e,r,i)<0){var o=e;e=i,i=o}n[0]=e,n[1]=r,n[2]=i},M}function a(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function h(n,t){for(var e=0;e<t.length;e++){var r=t[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function o(n,t,e){return t&&h(n.prototype,t),e&&h(n,e),n}function w(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}var u=function(){function n(t,e,r){if(a(this,n),!s)throw"Use html5qrcode.min.js without edit, getLazarSoftScannernot found.";if(this.qrcode=s(t),!this.qrcode)throw"qrcode is not defined, use the minified/html5-qrcode.min.js for proper support";this._container=t,this._elementId=e,this._foreverScanTimeout=null,this._localMediaStream=null,this._shouldScan=!0,this._url=window.URL||window.webkitURL||window.mozURL||window.msURL,this._userMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,this._isScanning=!1,n.VERBOSE=!0===r}return o(n,[{key:"start",value:function(t,e,r,i){var s=this;if(!t)throw"cameraId is required";if(!r||"function"!=typeof r)throw"qrCodeSuccessCallback is required and should be a function.";i||(i=console.log),this._clearElement();var a=this,h=e||{};h.fps=h.fps?h.fps:n.SCAN_DEFAULT_FPS;var o=null!=h.qrbox,w=this._container.querySelector("#"+this._elementId),u=w.clientWidth?w.clientWidth:n.DEFAULT_WIDTH;if(w.style.position="relative",this._shouldScan=!0,this._element=w,this.qrcode.callback=r,o){var f=h.qrbox;if(f<n.MIN_QR_BOX_SIZE)throw"minimum size of 'config.qrbox' is"+" ".concat(n.MIN_QR_BOX_SIZE,"px.");if(f>u)throw"'config.qrbox' should not be greater than the width of the HTML element."}var c=function(t){return new Promise((function(e,r){var f;a._localMediaStream=t,f=s._createVideoElement(u),a._element.append(f),f.onabort=r,f.onerror=r,f.onplaying=function(){!function(n,t){var e=h.qrbox;e>t&&console.warn("[Html5Qrcode] config.qrboxsize is greater than video height. Shading will be ignored");var r=o&&e<=t,i={x:0,y:0,width:n,height:t},u=r?s._getShadedRegionBounds(n,t,e):i,f=s._createCanvasElement(u.width,u.height),c=f.getContext("2d");c.canvas.width=u.width,c.canvas.height=u.height,w.append(f),r&&s._possiblyInsertShadingElement(w,t,u),a._qrRegion=u,a._context=c,a._canvasElement=f}(f.clientWidth,f.clientHeight),function t(){if(a._shouldScan){if(a._localMediaStream){var e=a._videoElement;a._context.drawImage(a._videoElement,a._qrRegion.x,a._qrRegion.y,a._qrRegion.width*(e.videoWidth/e.clientWidth),a._qrRegion.height*(e.videoHeight/e.clientHeight),0,0,a._qrRegion.width,a._qrRegion.height);try{a.qrcode.decode(),s._possiblyUpdateShaders(!0)}catch(n){s._possiblyUpdateShaders(!1),i("QR code parse error, error = ".concat(n))}}a._foreverScanTimeout=setTimeout(t,n._getTimeoutFps(h.fps))}}(),e()},f.srcObject=t,f.play(),a._videoElement=f}))};return new Promise((function(n,e){navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!1,video:{deviceId:{exact:t}}}).then((function(t){c(t).then((function(){a._isScanning=!0,n()})).catch(e)})).catch((function(n){e("Error getting userMedia, error = ".concat(n))})):navigator.getUserMedia?navigator.getUserMedia({video:{optional:[{sourceId:t}]}},(function(t){c(t).then((function(){a._isScanning=!0,n()})).catch(e)}),(function(n){e("Error getting userMedia, error = ".concat(n))})):e("Web camera streaming not supported by the browser.")}))}},{key:"stop",value:function(){this._shouldScan=!1,clearTimeout(this._foreverScanTimeout);var t=this;return new Promise((function(e){t.qrcode.callback=null;var r=t._localMediaStream.getVideoTracks().length,i=0;t._localMediaStream.getVideoTracks().forEach((function(s){s.stop(),++i>=r&&(t._localMediaStream=null,t._element.removeChild(t._videoElement),t._element.removeChild(t._canvasElement),function(){for(;t._element.getElementsByClassName(n.SHADED_REGION_CLASSNAME).length;){var e=t._element.getElementsByClassName(n.SHADED_REGION_CLASSNAME)[0];t._element.removeChild(e)}}(),t._isScanning=!1,t._qrRegion&&(t._qrRegion=null),t._context&&(t._context=null),e(!0))}))}))}},{key:"scanFile",value:function(t,e){var r=this;if(!(t&&t instanceof File))throw"imageFile argument is mandatory and should be instance of File. Use 'event.target.files[0]'";if(e=void 0===e||e,r._isScanning)throw"Close ongoing scan before scanning a file.";return new Promise((function(i,s){r._possiblyCloseLastScanImageFile(),r._clearElement(),r._lastScanImageFile=t;var a=new Image;a.onload=function(){var t=a.width,h=a.height,o=r._container.querySelector("#"+r._elementId),w=o.clientWidth?o.clientWidth:n.DEFAULT_WIDTH,u=Math.max(o.clientHeight?o.clientHeight:h,n.FILE_SCAN_MIN_HEIGHT),f=function t(e,r,i,s){if(e<=i&&r<=s)return{x:(i-e)/2,y:(s-r)/2,width:e,height:r};var a=e,h=r;return e>i&&(r*=i/e,e=i),r>s&&(e*=s/r,r=s),n._log("Image downsampled from "+"".concat(a,"X").concat(h)+" to ".concat(e,"X").concat(r,".")),t(e,r,i,s)}(t,h,w,u);if(e){var c=r._createCanvasElement(w,u,"qr-canvas-visible");c.style.display="inline-block",o.appendChild(c);var v=c.getContext("2d");v.canvas.width=w,v.canvas.height=u,v.drawImage(a,0,0,t,h,f.x,f.y,f.width,f.height)}var l=r._createCanvasElement(f.width,f.height);o.appendChild(l);var d=l.getContext("2d");d.canvas.width=f.width,d.canvas.height=f.height,d.drawImage(a,0,0,t,h,0,0,f.width,f.height);try{i(r.qrcode.decode())}catch(n){s("QR code parse error, error = ".concat(n))}},a.onerror=s,a.onabort=s,a.onstalled=s,a.onsuspend=s,a.src=URL.createObjectURL(t)}))}},{key:"clear",value:function(){this._clearElement()}},{key:"_clearElement",value:function(){if(this._isScanning)throw"Cannot clear while scan is ongoing, close it first.";console.log(this._container),this._container.querySelector("#"+this._elementId).innerHTML=""}},{key:"_createCanvasElement",value:function(n,t,e){var r=n,i=t,s=document.createElement("canvas");return s.style.width="".concat(r,"px"),s.style.height="".concat(i,"px"),s.style.display="none",s.id=null==e?"qr-canvas":e,s}},{key:"_createVideoElement",value:function(n){var t=document.createElement("video");return t.style.width="".concat(n,"px"),t.muted=!0,t.playsInline=!0,t}},{key:"_getShadedRegionBounds",value:function(n,t,e){if(e>n||e>t)throw"'config.qrbox' should not be greater than the width and height of the HTML element.";return{x:(n-e)/2,y:(t-e)/2,width:e,height:e}}},{key:"_possiblyInsertShadingElement",value:function(t,e,r){var i=this;if(0!=r.x||0!=r.y){var s={};s[n.SHADED_LEFT]=this._createShadedElement(e,r,n.SHADED_LEFT),s[n.SHADED_RIGHT]=this._createShadedElement(e,r,n.SHADED_RIGHT),s[n.SHADED_TOP]=this._createShadedElement(e,r,n.SHADED_TOP),s[n.SHADED_BOTTOM]=this._createShadedElement(e,r,n.SHADED_BOTTOM),Object.keys(s).forEach((function(n){return t.append(s[n])})),r.x<10||r.y<10?this.hasBorderShaders=!1:(Object.keys(s).forEach((function(n){return i._insertShaderBorders(s[n],r,n)})),this.hasBorderShaders=!0)}}},{key:"_createShadedElement",value:function(t,e,r){var i=document.createElement("div");switch(i.style.position="absolute",i.style.height="".concat(t,"px"),i.className=n.SHADED_REGION_CLASSNAME,i.id="".concat(n.SHADED_REGION_CLASSNAME,"_").concat(r),i.style.background="#0000007a",r){case n.SHADED_LEFT:i.style.top="0px",i.style.left="0px",i.style.width="".concat(e.x,"px"),i.style.height="".concat(t,"px");break;case n.SHADED_RIGHT:i.style.top="0px",i.style.right="0px",i.style.width="".concat(e.x,"px"),i.style.height="".concat(t,"px");break;case n.SHADED_TOP:i.style.top="0px",i.style.left="".concat(e.x,"px"),i.style.width="".concat(e.width,"px"),i.style.height="".concat(e.y,"px");break;case n.SHADED_BOTTOM:i.style.top="".concat(e.y+e.height,"px"),i.style.left="".concat(e.x,"px"),i.style.width="".concat(e.width,"px"),i.style.height="".concat(e.y,"px");break;default:throw"Unsupported shadingPosition"}return i}},{key:"_insertShaderBorders",value:function(t,e,r){r=parseInt(r);var i=this,s=function(e,s){if(null===e||null===s)throw"Shaders should have defined positions";var a=function(){var t=document.createElement("div");switch(t.style.position="absolute",t.style.backgroundColor=n.BORDER_SHADER_DEFAULT_COLOR,r){case n.SHADED_LEFT:case n.SHADED_RIGHT:t.style.width="".concat(5,"px"),t.style.height="".concat(45,"px");break;case n.SHADED_TOP:case n.SHADED_BOTTOM:t.style.width="".concat(45,"px"),t.style.height="".concat(5,"px");break;default:throw"Unsupported shadingPosition"}return t}();a.style.top="".concat(e,"px"),a.style.left="".concat(s,"px"),t.appendChild(a),i.borderShaders||(i.borderShaders=[]),i.borderShaders.push(a)},a=null,h=null,o=null,w=null;switch(r){case n.SHADED_LEFT:a=e.y-5,o=e.y+e.height-40,w=h=e.x-5;break;case n.SHADED_RIGHT:a=e.y-5,o=e.y+e.height-40,w=h=0;break;case n.SHADED_TOP:h=-5,o=a=e.y-5,w=e.width-40;break;case n.SHADED_BOTTOM:h=-5,o=a=0,w=e.width-40;break;default:throw"Unsupported shadingPosition"}s(a,h),s(o,w)}},{key:"_possiblyUpdateShaders",value:function(t){this.qrMatch!==t&&(this.hasBorderShaders&&this.borderShaders&&this.borderShaders.length&&this.borderShaders.forEach((function(e){e.style.backgroundColor=t?n.BORDER_SHADER_MATCH_COLOR:n.BORDER_SHADER_DEFAULT_COLOR})),this.qrMatch=t)}},{key:"_possiblyCloseLastScanImageFile",value:function(){this._lastScanImageFile&&(URL.revokeObjectURL(this._lastScanImageFile),this._lastScanImageFile=null)}}],[{key:"getCameras",value:function(){var n=this;return new Promise((function(t,e){navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&navigator.mediaDevices.getUserMedia?(n._log("navigator.mediaDevices used"),navigator.mediaDevices.getUserMedia({audio:!1,video:!0}).then((function(r){r.oninactive=function(){return n._log("All streams closed")},navigator.mediaDevices.enumerateDevices().then((function(e){for(var i=[],s=0;s<e.length;s++){var a=e[s];"videoinput"==a.kind&&i.push({id:a.deviceId,label:a.label})}n._log("".concat(i.length," results found")),function(n){for(var t=n.getVideoTracks(),e=0;e<t.length;e++){var r=t[e];r.enabled=!1,r.stop(),n.removeTrack(r)}}(r),t(i)})).catch((function(n){e("".concat(n.name," : ").concat(n.message))}))})).catch((function(n){e("".concat(n.name," : ").concat(n.message))}))):MediaStreamTrack&&MediaStreamTrack.getSources?(n._log("MediaStreamTrack.getSources used"),MediaStreamTrack.getSources((function(e){for(var r=[],i=0;i!==e.length;++i){var s=e[i];"video"===s.kind&&r.push({id:s.id,label:s.label})}n._log("".concat(r.length," results found")),t(r)}))):(n._log("unable to query supported devices."),e("unable to query supported devices."))}))}},{key:"_getTimeoutFps",value:function(n){return 1e3/n}},{key:"_log",value:function(t){n.VERBOSE&&console.log(t)}}]),n}();w(u,"DEFAULT_WIDTH",300),w(u,"DEFAULT_WIDTH_OFFSET",2),w(u,"FILE_SCAN_MIN_HEIGHT",300),w(u,"SCAN_DEFAULT_FPS",2),w(u,"MIN_QR_BOX_SIZE",50),w(u,"SHADED_LEFT",1),w(u,"SHADED_RIGHT",2),w(u,"SHADED_TOP",3),w(u,"SHADED_BOTTOM",4),w(u,"SHADED_REGION_CLASSNAME","qr-shaded-region"),w(u,"VERBOSE",!1),w(u,"BORDER_SHADER_DEFAULT_COLOR","#ffffff"),w(u,"BORDER_SHADER_MATCH_COLOR","rgb(90, 193, 56)");var f=function(){function n(t,e,r,i){if(a(this,n),this.container=t,this.elementId=e,this.config=r,this.verbose=!0===i,!t.querySelector("#"+e))throw"HTML Element with id=".concat(e," not found");this.currentScanType=n.SCAN_TYPE_CAMERA,this.sectionSwapAllowed=!0,this.section=void 0,this.html5Qrcode=void 0,this.qrCodeSuccessCallback=void 0,this.qrCodeErrorCallback=void 0}return o(n,[{key:"render",value:function(t,e){var r=this;this.lastMatchFound=void 0,this.qrCodeSuccessCallback=function(e){if(r.__setStatus("MATCH",n.STATUS_SUCCESS),t)t(e);else{if(r.lastMatchFound==e)return;r.lastMatchFound=e,r.__setHeaderMessage("Last Match: ".concat(e),n.STATUS_SUCCESS)}},this.qrCodeErrorCallback=function(n){r.__setStatus("Scanning"),e&&e(n)};var i=this.container.querySelector("#"+this.elementId);i.innerHTML="",this.__createBasicLayout(i),this.html5Qrcode=new u(this.container,this.__getScanRegionId(),this.verbose)}},{key:"clear",value:function(){var n=this,t=this;if(this.html5Qrcode)return new Promise((function(e,r){n.html5Qrcode._isScanning()&&n.html5Qrcode.stop().then((function(){var r;t.html5Qrcode.clear(),(r=n.container.querySelector("#"+n.elementId))&&(r.innerHTML=""),e()})).catch((function(n){t.verbose&&console.error("Unable to stop qrcode scanner",n),r(n)}))}))}},{key:"__createBasicLayout",value:function(n){n.style.position="relative",n.style.padding="0px",n.style.border="1px solid silver",this.__createHeader(n);var t=document.createElement("div"),e=this.__getScanRegionId();t.id=e,t.style.width="100%",t.style.minHeight="100px",t.style.textAlign="center",n.appendChild(t),this.__insertCameraScanImageToScanRegion();var r=document.createElement("div"),i=this.__getDashboardId();r.id=i,r.style.width="100%",n.appendChild(r),this.__setupInitialDashboard(r)}},{key:"__setupInitialDashboard",value:function(n){this.__createSection(n),this.__createSectionControlPanel(),this.__createSectionSwap()}},{key:"__createHeader",value:function(n){var t=document.createElement("div");t.style.textAlign="left",t.style.margin="0px",t.style.padding="5px",t.style.fontSize="20px",t.style.borderBottom="1px solid rgba(192, 192, 192, 0.18)",n.appendChild(t);var e=document.createElement("span");e.innerHTML="QR Code Scanner",t.appendChild(e);var r=document.createElement("span");r.id=this.__getStatusSpanId(),r.style.float="right",r.style.padding="5px 7px",r.style.fontSize="14px",r.style.background="#dedede6b",r.style.border="1px solid #00000000",r.style.color="rgb(17, 17, 17)",t.appendChild(r),this.__setStatus("IDLE");var i=document.createElement("div");i.id=this.__getHeaderMessageContainerId(),i.style.display="none",i.style.fontSize="14px",i.style.padding="2px 10px",i.style.marginTop="4px",i.style.borderTop="1px solid #f6f6f6",t.appendChild(i)}},{key:"__createSection",value:function(n){var t=document.createElement("div");t.id=this.__getDashboardSectionId(),t.style.width="100%",t.style.padding="10px",t.style.textAlign="left",n.appendChild(t)}},{key:"__createSectionControlPanel",value:function(){var t=this,e=this.container.querySelector("#"+this.__getDashboardSectionId()),r=document.createElement("div");e.appendChild(r);var i=document.createElement("div");i.id=this.__getDashboardSectionCameraScanRegionId(),i.style.display=this.currentScanType==n.SCAN_TYPE_CAMERA?"block":"none",r.appendChild(i);var s=document.createElement("div");s.style.textAlign="center";var a=document.createElement("button");a.innerHTML="Request Camera Permissions",a.addEventListener("click",(function(){a.disabled=!0,t.__setStatus("PERMISSION"),t.__setHeaderMessage("Requesting camera permissions..."),u.getCameras().then((function(e){t.__setStatus("IDLE"),t.__resetHeaderMessage(),e&&0!=e.length?(i.removeChild(s),t.__renderCameraSelection(e)):t.__setStatus("No Cameras",n.STATUS_WARNING)})).catch((function(e){a.disabled=!1,t.__setStatus("IDLE"),t.__setHeaderMessage(e,n.STATUS_WARNING)}))})),s.appendChild(a),i.appendChild(s);var h=document.createElement("div");h.id=this.__getDashboardSectionFileScanRegionId(),h.style.textAlign="center",h.style.display=this.currentScanType==n.SCAN_TYPE_CAMERA?"none":"block",r.appendChild(h);var o=document.createElement("input");o.id=this.__getFileScanInputId(),o.accept="image/*",o.type="file",o.style.width="200px",o.disabled=this.currentScanType==n.SCAN_TYPE_CAMERA;var w=document.createElement("span");w.innerHTML="&nbsp; Select Image",h.appendChild(o),h.appendChild(w),o.addEventListener("change",(function(e){t.currentScanType===n.SCAN_TYPE_FILE&&0!=e.target.files.length&&t.html5Qrcode.scanFile(e.target.files[0],!0).then((function(n){t.__resetHeaderMessage(),t.qrCodeSuccessCallback(n)})).catch((function(e){t.__setStatus("ERROR",n.STATUS_WARNING),t.__setHeaderMessage(e,n.STATUS_WARNING)}))}))}},{key:"__renderCameraSelection",value:function(t){var e=this,r=this.container.querySelector("#"+this.__getDashboardSectionCameraScanRegionId());r.style.textAlign="center";var i=document.createElement("span");i.innerHTML="Select Camera (".concat(t.length,") &nbsp;"),i.style.marginRight="10px";var s=document.createElement("select");s.id=this.__getCameraSelectionId();for(var a=0;a<t.length;a++){var h=t[a],o=h.id,w=null==h.label?o:h.label,u=document.createElement("option");u.value=o,u.innerHTML=w,s.appendChild(u)}i.appendChild(s),r.appendChild(i);var f=document.createElement("span"),c=document.createElement("button");c.innerHTML="Start Scanning",f.appendChild(c);var v=document.createElement("button");v.innerHTML="Stop Scanning",v.style.display="none",v.disabled=!0,f.appendChild(v),r.appendChild(f),c.addEventListener("click",(function(){s.disabled=!0,c.disabled=!0,e._showHideScanTypeSwapLink(!1),e.html5Qrcode.start(s.value,e.config?e.config:{fps:10,qrbox:250},e.qrCodeSuccessCallback,e.qrCodeErrorCallback).then((function(){v.disabled=!1,v.style.display="inline-block",c.style.display="none",e.__setStatus("Scanning")})).catch((function(t){e._showHideScanTypeSwapLink(!0),s.disabled=!1,c.disabled=!1,e.__setStatus("IDLE"),e.__setHeaderMessage(t,n.STATUS_WARNING)}))})),v.addEventListener("click",(function(){v.disabled=!0,e.html5Qrcode.stop().then((function(){e._showHideScanTypeSwapLink(!0),s.disabled=!1,c.disabled=!1,v.style.display="none",c.style.display="inline-block",e.__setStatus("IDLE"),e.__insertCameraScanImageToScanRegion()})).catch((function(t){v.disabled=!1,e.__setStatus("ERROR",n.STATUS_WARNING),e.__setHeaderMessage(t,n.STATUS_WARNING)}))}))}},{key:"__createSectionSwap",value:function(){var t=this,e=this.container.querySelector("#"+this.__getDashboardSectionId()),r=document.createElement("div");r.style.textAlign="center";var i=document.createElement("a");i.style.textDecoration="underline",i.id=this.__getDashboardSectionSwapLinkId(),i.innerHTML=this.currentScanType==n.SCAN_TYPE_CAMERA?"Scan an Image File":"Scan using camera directly",i.href="#scan-using-file",i.addEventListener("click",(function(){t.sectionSwapAllowed?(t.__setStatus("IDLE"),t.__resetHeaderMessage(),t.__getFileScanInput().value="",t.sectionSwapAllowed=!1,t.currentScanType==n.SCAN_TYPE_CAMERA?(t.__clearScanRegion(),t.__getFileScanInput().disabled=!1,t.__getCameraScanRegion().style.display="none",t.__getFileScanRegion().style.display="block",i.innerHTML="Scan using camera directly",t.currentScanType=n.SCAN_TYPE_FILE,t.__insertFileScanImageToScanRegion()):(t.__clearScanRegion(),t.__getFileScanInput().disabled=!0,t.__getCameraScanRegion().style.display="block",t.__getFileScanRegion().style.display="none",i.innerHTML="Scan an Image File",t.currentScanType=n.SCAN_TYPE_CAMERA,t.__insertCameraScanImageToScanRegion()),t.sectionSwapAllowed=!0):t.verbose&&console.error("Section swap called when not allowed")})),r.appendChild(i),e.appendChild(r)}},{key:"__setStatus",value:function(t,e){e||(e=n.STATUS_DEFAULT);var r=this.container.querySelector("#"+this.__getStatusSpanId());switch(r.innerHTML=t,e){case n.STATUS_SUCCESS:r.style.background="#6aaf5042",r.style.color="#477735";break;case n.STATUS_WARNING:r.style.background="#cb243124",r.style.color="#cb2431";break;case n.STATUS_DEFAULT:default:r.style.background="#eef",r.style.color="rgb(17, 17, 17)"}}},{key:"__resetHeaderMessage",value:function(){this.container.querySelector("#"+this.__getHeaderMessageContainerId()).style.display="none"}},{key:"__setHeaderMessage",value:function(t,e){e||(e=n.STATUS_DEFAULT);var r=this.container.querySelector("#"+this.__getHeaderMessageContainerId());switch(r.innerHTML=t,r.style.display="block",e){case n.STATUS_SUCCESS:r.style.background="#6aaf5042",r.style.color="#477735";break;case n.STATUS_WARNING:r.style.background="#cb243124",r.style.color="#cb2431";break;case n.STATUS_DEFAULT:default:r.style.background="#00000000",r.style.color="rgb(17, 17, 17)"}}},{key:"_showHideScanTypeSwapLink",value:function(n){!0!==n&&(n=!1),this.sectionSwapAllowed=n,this.__getDashboardSectionSwapLink().style.display=n?"inline-block":"none"}},{key:"__insertCameraScanImageToScanRegion",value:function(){var t=this,e=this.container.querySelector("#"+this.__getScanRegionId());if(this.cameraScanImage)return e.innerHTML="<br>",void e.appendChild(this.cameraScanImage);this.cameraScanImage=new Image,this.cameraScanImage.onload=function(){e.innerHTML="<br>",e.appendChild(t.cameraScanImage)},this.cameraScanImage.width=64,this.cameraScanImage.style.opacity=.3,this.cameraScanImage.src=n.ASSET_CAMERA_SCAN}},{key:"__insertFileScanImageToScanRegion",value:function(){var t=this,e=this.container.querySelector("#"+this.__getScanRegionId());if(this.fileScanImage)return e.innerHTML="<br>",void e.appendChild(this.fileScanImage);this.fileScanImage=new Image,this.fileScanImage.onload=function(){e.innerHTML="<br>",e.appendChild(t.fileScanImage)},this.fileScanImage.width=64,this.fileScanImage.style.opacity=.3,this.fileScanImage.src=n.ASSET_FILE_SCAN}},{key:"__clearScanRegion",value:function(){this.container.querySelector("#"+this.__getScanRegionId()).innerHTML=""}},{key:"__getDashboardSectionId",value:function(){return"".concat(this.elementId,"__dashboard_section")}},{key:"__getDashboardSectionCameraScanRegionId",value:function(){return"".concat(this.elementId,"__dashboard_section_csr")}},{key:"__getDashboardSectionFileScanRegionId",value:function(){return"".concat(this.elementId,"__dashboard_section_fsr")}},{key:"__getDashboardSectionSwapLinkId",value:function(){return"".concat(this.elementId,"__dashboard_section_swaplink")}},{key:"__getScanRegionId",value:function(){return"".concat(this.elementId,"__scan_region")}},{key:"__getDashboardId",value:function(){return"".concat(this.elementId,"__dashboard")}},{key:"__getFileScanInputId",value:function(){return"".concat(this.elementId,"__filescan_input")}},{key:"__getStatusSpanId",value:function(){return"".concat(this.elementId,"__status_span")}},{key:"__getHeaderMessageContainerId",value:function(){return"".concat(this.elementId,"__header_message")}},{key:"__getCameraSelectionId",value:function(){return"".concat(this.elementId,"__camera_selection")}},{key:"__getCameraScanRegion",value:function(){return this.container.querySelector("#"+this.__getDashboardSectionCameraScanRegionId())}},{key:"__getFileScanRegion",value:function(){return this.container.querySelector("#"+this.__getDashboardSectionFileScanRegionId())}},{key:"__getFileScanInput",value:function(){return this.container.querySelector("#"+this.__getFileScanInputId())}},{key:"__getDashboardSectionSwapLink",value:function(){return this.container.querySelector("#"+this.__getDashboardSectionSwapLinkId())}}]),n}();w(f,"SCAN_TYPE_CAMERA","SCAN_TYPE_CAMERA"),w(f,"SCAN_TYPE_FILE","SCAN_TYPE_FILE"),w(f,"STATUS_SUCCESS","STATUS_SUCCESS"),w(f,"STATUS_WARNING","STATUS_WARNING"),w(f,"STATUS_DEFAULT","STATUS_DEFAULT"),w(f,"ASSET_FILE_SCAN","https://raw.githubusercontent.com/mebjas/html5-qrcode/master/assets/file-scan.gif"),w(f,"ASSET_CAMERA_SCAN","https://raw.githubusercontent.com/mebjas/html5-qrcode/master/assets/camera-scan.gif");var c=function(n,t,e,r){var i,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,e):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,t,e,r);else for(var h=n.length-1;h>=0;h--)(i=n[h])&&(a=(s<3?i(a):s>3?i(t,e,a):i(t,e))||a);return s>3&&a&&Object.defineProperty(t,e,a),a};const v=class{constructor(t){n(this,t),this.title=""}componentDidLoad(){new f(this.element,"reader",{fps:10,qrbox:250}).render(n=>{this.modelHandler.updateModel("data",n)})}render(){return t("psk-card",{title:this.title},t("div",{class:"code_container"},t("div",{class:"card-body text-center"},t("div",{id:"reader"}))))}get element(){return e(this)}};c([i()],v.prototype,"modelHandler",void 0),c([r()],v.prototype,"element",void 0);export{v as qr_code_reader}