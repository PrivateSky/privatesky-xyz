import{g as e}from"./p-1c0c10bb.js";import{d as t,a as n}from"./p-ba942fe7.js";function o(e){return null!==e&&"string"==typeof e&&!!e.startsWith("@")&&e.length>=2}function i(e,n,i){return!!o(n)&&void 0===i[e]&&void 0===t(n)&&"view-model"!==e}function r(e,t){switch(e){case"attr":return function(e,n){this.setAttribute(e,t.getChainValue(n))};default:return function(e,n){this[e]=t.getChainValue(n)}}}function l(e,t){this.createBoundedModel=function(o,i){return i=n(i),t.onChange(i,()=>{e(o,i)}),e(o,i),{updateModel:e=>{t.setChainValue(i,e)}}}}function s(e,t,o){let{properties:i,hasViewModel:s,instanceName:a}=t;e.dispatchEvent(new CustomEvent("getModelEvent",{bubbles:!0,composed:!0,detail:{callback:(t,u)=>{if(t&&console.error(t),s){let t=e.getAttribute("view-model");t=n(t);let o=u.getChainValue(t);for(let e in o)i[e]||(i[e]={value:t+"."+e,type:"prop"})}let c={};for(let n in i){let t="attr"===i[n].type?e:this,o=new l(r.call(t,i[n].type,u).bind(t),u);c[n]=o.createBoundedModel(n,i[n].value)}if(void 0!==this[a])throw new Error(`BindModel decorator received a wrong argument as instance name: [${a}]`);this[a]={updateModel:(e,t)=>{i[e]&&c[e].updateModel(t)}},o()}}}))}function a(){return(t,n)=>{let{componentWillLoad:r}=t;t.componentWillLoad=function(){let t=this.__proto__,l=this,a=e(l),u=e=>(e||(e=Promise.resolve()),e.then(()=>r&&r.call(l)),e);if(a.isConnected){let e=Object.keys(t),r=a.getAttributeNames(),c={};for(let t=0;t<e.length;t++){let n=e[t];o(this[n])&&(c[n]={value:this[n],type:"prop"})}for(let t=0;t<r.length;t++){let e=r[t],n=a.getAttribute(e);i(e,n,c)&&(c[e]={value:n,type:"attr"})}let f=a.hasAttribute("view-model");if(Object.keys(c).length>0||f)return u(new Promise(e=>{s.call(l,a,{properties:c,hasViewModel:f,instanceName:n},e)}))}return u()}}}export{a as B}