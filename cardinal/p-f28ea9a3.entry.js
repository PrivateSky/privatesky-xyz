import{r as e,h as t,g as i}from"./p-ab545ab4.js";import"./p-67893e64.js";import"./p-ba942fe7.js";import{T as o}from"./p-1c2c6971.js";import{C as r}from"./p-6f7d59d5.js";class n{static _prepareRoutesTree(e,t){let i=function(e){let o={};return e.forEach(e=>{let r=e.name.replace(/(\s+|-)/g,"").toLowerCase();if(!o[r]){let i=e.path;switch(t){case"browser":case"query":i=e.path;break;case"hash":i="/#"+e.path}o[r]={path:i}}if("object"==typeof e.children&&Array.isArray(e.children.items))o[r].children={type:"known",items:i(e.children.items)};else if("string"==typeof e.children&&0===e.children.indexOf("@event:")){let t=e.children.substring("@event:".length);o[r].children={type:"event",event:t}}}),o};return i(e)}static _prepareConfiguration(e,t){let i={};i.baseUrl=t;let o=t+"pages/",r=new URL(t).pathname;if(e.modals&&(i.modals={},Object.keys(e.modals).length))for(let n in e.modals)i.modals[n]=o+e.modals[n];if(!e.menu||!e.menu.defaultMenuConfig)throw new Error("Default menu configuration is missing");let s=e.menu.defaultMenuConfig;e.profile&&(i.profile=e.profile);let l=function(e){for(let t=0;t<e.length;t++)e[t].children&&e[t].children.items?l(e[t].children.items):void 0!==e[t].indexed&&"false"===e[t].indexed.toString()&&e.splice(t,1);return e},a=function(e,t){return t=t?t.replace(/^\/|\/$/g,""):"",e.forEach(e=>{if(!e.path){let t=e.name.toLowerCase().toLowerCase().replace(/\s+/g,"-");t=t.replace(/[:\/]/g,""),e.path=t}let i="/";0===t.length&&(i=""),e.path.startsWith("/")||(e.path=i+e.path);let r=t+e.path;if(r=r.replace(/^\//g,""),e.path=r,e.children)e.type="abstract",e.icon||(e.icon=s.icon);else{for(let t in s)e.hasOwnProperty(t)||(e[t]=s[t]);if("psk-page-loader"===e.component)if(e.componentProps||(e.componentProps={}),Object.assign(e.componentProps,e.options),e.pageSrc)e.componentProps.pageUrl=e.pageSrc.startsWith("http")?e.pageSrc:o+e.pageSrc;else{let r=e.name.replace(/[:.!?]/g,"").replace(/\s/g,"-").toLowerCase();e.componentProps.pageUrl=o+t+i+r+".html"}}if("object"==typeof e.children&&Array.isArray(e.children))e.children={type:"known",items:JSON.parse(JSON.stringify(e.children))},a(e.children.items,r);else if("string"==typeof e.children&&0==e.children.indexOf("@event:")){let t=e.children.substring("@event:".length);e.children={type:"event",event:t}}}),e};i.routes=a(e.menu.pages),i.historyType="browser";let p=e.menu.defaultMenuConfig.historyType;"hash"!==p&&"query"!==p||(i.historyType=p);let c=r;if("query"===p){let t="?";e.menu.defaultMenuConfig.pagePrefix&&(t=e.menu.defaultMenuConfig.pagePrefix),c=r+t}(e=>{let t=function(i){i.forEach(i=>{let o=i.path;0===o.indexOf("/")&&(o=o.substr(1)),i.path=`${e}${o}`,i.children&&i.children.items&&t(i.children.items)})};t(i.routes)})(c);let f=JSON.parse(JSON.stringify(i.routes));return i.menu=l(f),i.tags=function(e){let t=[];return function e(i){i.forEach(i=>{Object.prototype.hasOwnProperty.call(i,"tags")&&i.tags.split(",").map(e=>e.trim()).forEach(e=>{t[e]=i.path}),"object"==typeof i.children&&Array.isArray(i.children.items)&&e(i.children.items)})}(e),t}(f),i.pagesHierarchy=n._prepareRoutesTree(i.routes,p),i}}const s={theme:"default",appVersion:"1.0.0",profile:{username:"Cardinal App",email:"privatesky@axiologic.net",avatar:"https://privatesky.xyz/assets/images/privatesky.png"},menu:{defaultMenuConfig:{icon:"fa-bars",type:"route",component:"psk-page-loader",exact:!1,indexed:!0,historyType:"browser"},pages:[{name:"Home",path:"/home",pageSrc:"index.html"}]}};let l="app-config.json";window.globalConfig={};class a{constructor(e){let t;this.configIsLoaded=!1,this.pendingRequests=[],window&&window.location&&window.location.origin&&(t=window.location.origin);let i=document.querySelector("base");if(i){let e=i.getAttribute("href");e&&(t+=e)}t.endsWith("/")||(t+="/"),l=t+l,window.basePath=t,this._getAppConfiguration(l,(e,i)=>{for(this.configuration=n._prepareConfiguration(i,t),this.configuration.theme=i.theme,this.configuration.appVersion=i.appVersion,this.configIsLoaded=!0;this.pendingRequests.length;){let e=this.pendingRequests.pop();if(!this.configuration[e.configName])throw new Error(`Config ${e.configName} was not provided. Did you set it in app-config.json?`);e.callback(void 0,this.configuration[e.configName])}}),e.addEventListener("getThemeConfig",this._provideConfig("theme")),e.addEventListener("getAppVersion",this._provideConfig("appVersion")),e.addEventListener("needRoutes",this._provideConfig("routes")),e.addEventListener("needMenuItems",this._provideConfig("menu")),e.addEventListener("getUserInfo",this._provideConfig("profile")),e.addEventListener("getHistoryType",this._provideConfig("historyType")),e.addEventListener("getModals",this._provideConfig("modals")),e.addEventListener("getTags",this._provideConfig("tags")),e.addEventListener("validateUrl",e=>{e.stopImmediatePropagation();let{sourceUrl:t,callback:i}=e.detail;i&&"function"==typeof i?this._parseSourceUrl(t,i):console.error("Callback was not properly provided!")}),e.addEventListener("getCustomLandingPage",e=>{let t=e.detail;if(window.frameElement&&window.frameElement.hasAttribute("landing-page"))return t(void 0,window.frameElement.getAttribute("landing-page"));t()})}_provideConfig(e){return t=>{t.stopImmediatePropagation();let i=t.detail;if(i&&"function"==typeof i)if(this.configIsLoaded){if(!this.configuration[e])throw new Error(`Config ${e} was not provided`);i(void 0,this.configuration[e])}else this.pendingRequests.push({configName:e,callback:i})}}_parseSourceUrl(e,t){let i=(e=e.replace(/(\s+|-)/g,"").toLowerCase()).split("/"),o=this.configuration.pagesHierarchy;for(let r=0;r<i.length;r++){let n=i[r];const s=Object.keys(o).find((function(e){return-1!==o[e].path.toLowerCase().indexOf(n)}));let l,a,p=void 0!==o[s];if(!o[n]&&!p){t(e+" is not a valid path in the application!");break}if(l=p?o[s].children:o[n].children,"object"!=typeof l||"object"!=typeof l.items||r===i.length)return a=p?o[s].path:o[n].path,t(void 0,a);o=l.items}}_getAppConfiguration(e,t){let i=new XMLHttpRequest;i.open("GET",e),i.onload=()=>{if(200!=i.status)console.error("Configuration file app-config.json was not found!"),t(null,s);else{let e=JSON.parse(i.responseText);for(let t in s)e.hasOwnProperty(t)||(e[t]=s[t]);t(null,e)}},i.onerror=()=>{t(new Error("An error occurred"))},i.send()}}let p=(()=>{class n{constructor(t){e(this,t),this.mobileLayout=!1,this.componentCode="",this.hasSlot=!1}__createLoader(){let e="";for(let i=1;i<=12;i++)e+=`<div class="sk-circle${i} sk-circle"></div>`;let t=document.createElement("div");return t.className="app-loader",t.innerHTML=`<div class='sk-fading-circle'>${e}</div>`,t}connectedCallback(){this.disconnected=!1}disconnectedCallback(){this.disconnected=!0}componentWillLoad(){this.host.parentElement&&(this.htmlLoader=this.__createLoader(),this.host.parentElement.appendChild(this.htmlLoader));let e=this.host.innerHTML;if(e=e.replace(/\s/g,""),e.length&&(this.hasSlot=!0),"string"==typeof this.controller)return new Promise((e,t)=>{r.getController(this.controller).then(t=>{if(this.disconnected)return e();new t(this.host),e()}).catch(t)});new a(this.host)}componentDidLoad(){this.htmlLoader&&this.htmlLoader.parentNode&&this.htmlLoader.parentNode.removeChild(this.htmlLoader)}render(){return t(this.hasSlot?"slot":"psk-default-renderer",null)}get host(){return i(this)}}return function(e,t,i,o){var r,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(s=(n<3?r(s):n>3?r(t,i,s):r(t,i))||s);n>3&&s&&Object.defineProperty(t,i,s)}([o({isMandatory:!1,description:["This property is a string that will permit the developer to choose his own controller.","If no controller is provided, a default controller will be passed to the component","It is recommended that each app to extend the provided default controller and adapt it to the application needs"],propertyType:"string",defaultValue:"null"})],n.prototype,"controller",void 0),n})();export{p as psk_app_root}