import{r as t,h as i,H as s}from"./p-d4191909.js";import{H as e}from"./p-f0bd18cd.js";import{j as n}from"./p-e33c1597.js";import"./p-0c3518a5.js";import{U as a}from"./p-93b02efe.js";async function o(t){try{return!0===(await fetch(t,{method:"head"})).ok}catch(i){return console.log("Error while checking a page from "+t,i),!1}}const{join:h}=a,r=class{constructor(i){t(this,i),this.content="",this.watchSkin=!1,this.skinSet=!1,this.basePath="/",this.loader="default",this.skin="default",this.translations=!1}async componentWillLoad(){this.host.isConnected&&(await this.setSkinContext(),await this.setPageContent(),this.updateActivePage(),this.watchSkin=!0)}async skinHandle(){this.watchSkin&&(this.skinSet?this.skinSet=!1:(this.content="",await this.setSkinContext(),await this.setPageContent(),this.updateActivePage()))}async setSkinContext(){if("none"!==this.skin){if("default"!==this.skin.toLowerCase()){const t=h(this.basePath,n,this.skin,this.src).pathname;if(await o(t))return void(this.activeSrc=t)}return void(this.activeSrc=h(this.basePath,this.src).pathname)}const t=this.getPreferredSkin();if(t&&"default"!==t.name.toLowerCase()){const i=h(this.basePath,n,t.name,this.src).pathname;if(await o(i))return this.activeSrc=i,this.skin=t.name,void(this.skinSet=!0)}this.activeSrc=h(this.basePath,this.src).pathname,this.skin="default",this.skinSet=!0}async setPageContent(){const t=this.activeSrc,i=await async function(t){try{const i=await fetch(t),s=await i.text();if(!i.ok)throw new Error(s);return s}catch(i){return console.log("Error while loading a page from "+t,i),null}}(t);this.content=i||`\n        <section style="padding: 1rem">\n            <h4>Page from <code>${t}</code> could not be loaded!</h4>\n            <h5>Current skin is <code>${this.skin}</code></h5>\n        </section>\n      `}updateActivePage(){window.WebCardinal.state.activePage={skin:{name:this.skin,translations:this.translations},src:this.src,loader:this.host}}getPreferredSkin(){let t;if(window.WebCardinal&&window.WebCardinal.state&&window.WebCardinal.state.activeSkin){if(t=window.WebCardinal.state.activeSkin,t.name)return t;console.error("A valid WebCardinal skin must have a name!")}else console.error('"activeSkin" can not be found in WebCardinal.state!')}render(){switch(this.loader){case"parser":{const t=new DOMParser;return this.host.append(t.parseFromString(this.content,"text/html")),i(s,Object.assign({},{style:{width:"100%",height:"100%"}}),i("slot",null))}case"iframe":return i("iframe",Object.assign({},{frameBorder:0,srcDoc:this.content,sandbox:"allow-scripts",style:{display:"block",overflow:"hidden",width:"100%",height:"100%"}}));case"object":return i("object",Object.assign({},{data:this.activeSrc,type:"text/html",style:{display:"block",width:"100%",height:"100%"}}));default:{const t={style:{width:"100%",height:"100%"}};return this.host.innerHTML=this.content,i(s,Object.assign({},t),i("slot",null))}}}static get watchers(){return{skin:["skinHandle"]}}};!function(t,i,s,e){var n,a=arguments.length,o=a<3?i:null===e?e=Object.getOwnPropertyDescriptor(i,s):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,i,s,e);else for(var h=t.length-1;h>=0;h--)(n=t[h])&&(o=(a<3?n(o):a>3?n(i,s,o):n(i,s))||o);a>3&&o&&Object.defineProperty(i,s,o)}([e()],r.prototype,"host",void 0);export{r as webc_app_loader}