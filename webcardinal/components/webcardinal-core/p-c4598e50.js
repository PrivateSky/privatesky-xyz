import{e,c as t,f as n,g as o,V as a,b as i,F as r,k as s,l,m as c,j as f,d as u,I as d,n as h,o as b,x as m,h as p,i as y,D as v}from"./p-61cc1f50.js";import{c as x,d as $}from"./p-0c3518a5.js";function g(e,t,n){let o=null;for(;e;){if(e.matches(t)){o=e;break}if(n&&e.matches(n))break;e=e.parentElement}return o}function M(t,{key:n,value:o}){if(!e.includes(n))if(["innerHTML","innerText"].includes(n)&&console.warn(`Model property "${n}" can be short handed, try "${n.substr(5).toLowerCase()}" instead!\n`,"target element:",t),["data-tag","data-view-model"].includes(n)&&console.warn(`Model property "${n}" can be shorthanded, try "${n.substr(5)}" instead!\n`,"target model:",t.getAttribute("data-model")),function(e){return["value","innerText","innerHTML"].includes(e)}(n=function(e){switch(e){case"model":return"data-view-model";case"tag":return"data-tag";case"text":return"innerText";case"html":return"innerHTML";default:return e}}(n))){if("INPUT"===t.tagName&&"file"===t.getAttribute("type")&&"value"===n)return;t[n]=o}else if("class"!==n)"boolean"!=typeof o?"string"!=typeof o?"object"!=typeof o||(t[n]=o):t.setAttribute(n,o):o?t.setAttribute(n,""):t.removeAttribute(n);else{if(""===o)return void(t.className="");if("string"==typeof o)return void t.classList.add(o);if("object"==typeof o){for(const[e,n]of Object.entries(o))n?t.classList.add(e):t.classList.remove(e);return}}}function k(e,t){return"input"===e.tagName.toLowerCase()&&"checkbox"===e.getAttribute("type")&&"checked"===t||"value"===t}function A(e,r,s=t,l=null){n.includes(e.tagName.toLowerCase())||e.tagName.startsWith(o.toUpperCase())||Array.from(e.attributes).forEach((n=>{const o=n.nodeName;let c=n.nodeValue;o!==a&&o!==i&&c.startsWith(s)&&(c=c.slice(1),l&&(c=H(l,c)),M(e,{key:o,value:r.getChainValue(c)}),s===t&&k(e,o)&&T(e,r,c),r.onChange(c,(()=>{M(e,{key:o,value:r.getChainValue(c)})})),r.hasExpression(c)&&(M(e,{key:o,value:r.evaluateExpression(c)}),s===t&&k(e,o)&&T(e,r,c),r.onChangeExpressionChain(c,(()=>{M(e,{key:o,value:r.evaluateExpression(c)})}))))}))}function j(e){e.nodeType===Node.ELEMENT_NODE&&(e.removeAttribute("slot"),e.removeAttribute("hidden"))}function T(e,t,n){const o=e.tagName.toLowerCase();["input","textarea"].includes(o)?e.addEventListener("input",(a=>{const i=a.target;"input"!==o||"checkbox"!==e.getAttribute("type")?"input"!==o||"file"!==e.getAttribute("type")?t.setChainValue(n,i.value):t.setChainValue(n,Array.from(i.files)):t.setChainValue(n,i.checked)})):"select"===o&&e.addEventListener("change",(e=>{t.setChainValue(n,e.target.value)}))}function P(e,t,n){if(!t.getChainValue(n))return;const o="input"===e.tagName.toLowerCase()&&"checkbox"===e.getAttribute("type")?"checked":"value";T(e,t,`${n}.${o}`)}function w(e,t){return Array.from(e.attributes).some((e=>e.nodeName===t))}function N(e,t){return e.filter((e=>e.getAttribute("slot")===t))}function O(e,t){return N(e,t).map((e=>e.outerHTML)).join("")}function E(e){for(;e.children.length>0;)e.children[0].remove()}function C(e){for(;e.childNodes.length>0;)e.childNodes[0].remove()}function H(...e){return e.filter((e=>null!=e)).filter(String).join(".")}function I(e,t,n){const o=t.getChainValue(n);if(o){for(const[t,n]of Object.entries(o))M(e,{key:t,value:n});if(!0===o._saveElement){for(const t in e)"function"==typeof e[t]&&(e[t]=e[t].bind(e));o.getElement||t.setChainValue(n,Object.assign(Object.assign({},o),{getElement:()=>e}))}}if(t.hasExpression(n)){const o=t.evaluateExpression(n);for(const[t,n]of Object.entries(o))M(e,{key:t,value:n})}}function L(e){return e.nodeType===Node.ELEMENT_NODE}function V(e){return e.nodeType===Node.TEXT_NODE&&e.nodeValue&&e.nodeValue.trim()}function W(e,o,a,i=null){if(n.includes(e.nodeName.toLowerCase()))return;if(e.nodeType!==Node.TEXT_NODE||!e.nodeValue||!e.nodeValue.trim())return;const r=[...e.nodeValue.matchAll(/\{\{\s*([^\s}}]+)\s*\}\}/g)];if(!r.length)return;const s=r.map((e=>({expression:e[0],chainWithPrefix:e[1]}))).filter((({chainWithPrefix:e})=>e.startsWith(t)||e.startsWith(u))).map((e=>{let{chainWithPrefix:n}=e;const r=n.startsWith(u);let s=e.chainWithPrefix.slice(1);!r&&i&&(s=H(i,s),n=`${t}${s}`);const l=r?a:o;return Object.assign(Object.assign({},e),{chain:s,isTranslation:r,isModel:!r,isModelExpression:l.hasExpression(s),evaluateModelExpression:()=>l.evaluateExpression(s),model:l,getChainValue:()=>{let e=l.getChainValue(s);if(r&&void 0===e){const{pathname:t}=window.location,n=m();console.warn(`No translations found for skin "${n}", page "${t}" and chain "${s}"`),e=s}return e}})}));if(!s.length)return;const l=e.nodeValue,c=()=>{let t=l;s.forEach((({expression:e,getChainValue:n,isModelExpression:o,evaluateModelExpression:a})=>{let i=n();["number","boolean"].includes(typeof i)&&(i=i.toString()),!i&&o&&(i=o?a():""),t=t.replace(e,i||"")})),e.nodeValue=t};c(),s.filter((e=>e.isModel)).forEach((({model:e,chain:t,isModelExpression:n})=>{e.onChange(t,(()=>{c()})),n&&e.onChangeExpressionChain(t,(()=>{c()}))}))}const S={bindElement:(e,m={model:null,translationModel:null})=>{const{model:g,translationModel:M,chainPrefix:k,enableTranslations:T=!1,recursive:O=!1}=m;if(g){if(V(e))W(e,g,M,k);else if(L(e)){const E=e;if(n.includes(E.tagName.toLowerCase()))return;if(E.hasAttribute(p)){let e;E.hasAttribute(i)&&(e=E.getAttribute(i),(null==e?void 0:e.startsWith(t))&&(e=e.slice(1)));const n=H(k,e);E[y]=()=>g.hasExpression(n)?g.evaluateExpression(n):g.toObject(n)}const U=w(E,d),B=w(E,r);if(U&&B)console.error("Cannot use both data-if and data-for attributes on the same element",E);else if(U)!function(e,n,{model:o,translationModel:a,chainPrefix:i,enableTranslations:r=!1}={model:null,translationModel:null}){let s=e.getAttribute(d);if(!s.startsWith(t))return void console.warn(`Attribute "${d}" doesn't start with the chain prefix!`);s=s.slice(1);const l=H(i,s),c=Array.from(e.children);let f,m=N(c,h);const p=N(c,b);m.length||p.length||(m=Array.from(e.childNodes)),C(e);const y=async t=>{let s;if(t instanceof Promise)try{s=await t}catch(e){console.error("data-if condition promise failed",e),s=!1}else s=!!t;const l=f!==s;f=s,l&&(()=>{const t=f?m:p;C(e),t.forEach((t=>{const s=t.cloneNode(!0);j(s),e.appendChild(s),n(s,{model:o,translationModel:a,chainPrefix:i,enableTranslations:r,recursive:!0})}))})()};y(o.getChainValue(l)),A(e,o,t,i),r&&A(e,a,u,i),o.onChange(l,(()=>{y(o.getChainValue(l))})),o.hasExpression(l)&&(y(o.evaluateExpression(l)),o.onChangeExpressionChain(l,(()=>{y(o.evaluateExpression(l))})))}(E,S.bindElement,m);else if(B)!function(e,n,{model:o,translationModel:a,chainPrefix:i,enableTranslations:d=!1}={model:null,translationModel:null}){let h=e.getAttribute(r);if(!h.startsWith(t))return void console.warn(`Attribute "${r}" doesn't start with the chain prefix!`);h=h.slice(1);const b=H(i,h);let m=o.getChainValue(b);if(!Array.isArray(m))return void console.error(`Attribute "${r}" (${h}) must be a chain to an array in the model!`,e);let p=m.length;const y=(e.getAttribute(s)||"").split(" ").filter(String),v=y.includes(l);let g=y.includes(c);const M=[],k=[];for(;e.childNodes.length>0;){const t=e.childNodes[0];L(t)&&t.getAttribute("slot")===f?M.push(t):k.push(t),t.remove()}let T=[];const P=()=>{if(!p)return C(e),void M.forEach((t=>{const r=t.cloneNode(!0);j(r),e.appendChild(r),n(r,{model:o,translationModel:a,chainPrefix:i,enableTranslations:d,recursive:!0})}));if(g){const t=document.createElement(e.tagName),n=Array.prototype.slice.call(e.attributes);let o;for(;o=n.pop();)o.nodeName!==s&&t.setAttribute(o.nodeName,o.nodeValue);y.length>0&&t.setAttribute(s,y.join(" ")),e.insertAdjacentElement("afterend",t),e.remove(),e=t}m.forEach(((t,i)=>{const r=[];k.forEach((e=>{const t=e.cloneNode(!0),s=H(b,i);n(t,{model:o,translationModel:a,chainPrefix:s,enableTranslations:d,recursive:!0}),r.push(t)})),T[i]?r.forEach(((e,t)=>{document.createElement("div").appendChild(T[i][t].cloneNode(!0));const n=x(e),o=x(T[i][t]);$(n,o,T[i][t])})):(r.forEach((t=>{e.appendChild(t)})),T[i]=r)}));for(let e=p;e<T.length;e++)T[e].forEach((e=>{C(e),e.remove()}));T.splice(p)},w=(t,n=!1)=>{Array.isArray(t)||(console.error(`Attribute "${r}" must be an array in the model!`),t=[]);const o=p!==(t=t||[]).length;m=t,p=m.length,v?P():(n||o)&&(C(e),T=[],P())};P(),A(e,o,t,i),d&&A(e,a,u,i),o.onChange(b,(({targetChain:e})=>{const t=b===e;w(o.getChainValue(b),t)})),o.hasExpression(b)&&o.onChangeExpressionChain(b,(()=>{w(o.evaluateExpression(b))}))}(E,S.bindElement,m);else{const e=E.hasAttribute(a),n=E.hasAttribute(i);if(!E.hasAttribute(v)){if(e||n){let o;if(e?o=E.getAttribute(a):(console.warn(`Attribute "${i}" is deprecated for binding! Use the "${a}" key attribute instead.`,E),o=E.getAttribute(i)),o.startsWith(t)){o=o.slice(1);const e=H(k,o);E.setAttribute(a,`${t}${e}`),n&&E.setAttribute(i,`${t}${e}`),I(E,g,e),P(E,g,e),g.onChange(e,(()=>I(E,g,e))),g.hasExpression(e)&&g.onChangeExpressionChain(e,(()=>I(E,g,e)))}else console.warn(`Invalid chain found! (chain: "${o}")!\n`,`A valid chain must start with "${t}".\n`,"target element:",E)}E.tagName.startsWith(o.toUpperCase())||A(E,g,t,k),T&&A(E,M,u,k),Array.from(E.childNodes).filter(V).forEach((e=>{W(e,g,M,k)}))}O&&Array.from(E.children).forEach((e=>{S.bindElement(e,m)}))}}}else{const t=L(e)?e.tagName.toLowerCase():"text node";console.warn(`No model found for: ${t}!`)}},bindChildNodes:(e,t)=>{Array.from(e.childNodes).forEach((e=>{S.bindElement(e,Object.assign({},t))}))}};export{S as B,T as a,A as b,P as c,N as d,O as e,E as f,g,C as h,w as i,H as j,j as r,M as s}