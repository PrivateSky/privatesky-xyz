import{e,M as n,f as t,P as o,V as a,h as i,g as r,F as s,i as l,j as c,k as u,m as f,T as d,I as h,n as p,o as b,c as m,p as y,q as v,D as x}from"./p-0aafcc26.js";import{p as $}from"./p-794858b0.js";import{c as g,d as M}from"./p-0c3518a5.js";function k(e,n,t){let o=null;for(;e;){if(e.matches(n)){o=e;break}if(t&&e.matches(t))break;e=e.parentElement}return o}function A(n,{key:t,value:o}){if(!e.includes(t))if(["innerHTML","innerText"].includes(t)&&console.warn(`Model property "${t}" can be short handed, try "${t.substr(5).toLowerCase()}" instead!\n`,"target element:",n),["data-tag","data-view-model"].includes(t)&&console.warn(`Model property "${t}" can be shorthanded, try "${t.substr(5)}" instead!\n`,"target model:",n.getAttribute("data-model")),function(e){return["value","innerText","innerHTML"].includes(e)}(t=function(e){switch(e){case"model":return"data-view-model";case"tag":return"data-tag";case"text":return"innerText";case"html":return"innerHTML";default:return e}}(t))){if("INPUT"===n.tagName&&"file"===n.getAttribute("type")&&"value"===t)return;n[t]=o}else if("class"!==t)"boolean"!=typeof o?"string"!=typeof o?"object"!=typeof o||(n[t]=o):n.setAttribute(t,o):o?n.setAttribute(t,""):n.removeAttribute(t);else{if(""===o)return void(n.className="");if("string"==typeof o)return void n.classList.add(o);if("object"==typeof o){for(const[e,t]of Object.entries(o))t?n.classList.add(e):n.classList.remove(e);return}}}function j(e,n){return"input"===e.tagName.toLowerCase()&&"checkbox"===e.getAttribute("type")&&"checked"===n||"value"===n}function T(e,r,s=n,l=null){t.includes(e.tagName.toLowerCase())||e.tagName.startsWith(o.toUpperCase())||Array.from(e.attributes).forEach((t=>{const o=t.nodeName;let c=t.nodeValue;o!==a&&o!==i&&c.startsWith(s)&&(c=c.slice(1),l&&(c=L(l,c)),A(e,{key:o,value:r.getChainValue(c)}),s===n&&j(e,o)&&w(e,r,c),r.onChange(c,(()=>{A(e,{key:o,value:r.getChainValue(c)})})),r.hasExpression(c)&&(A(e,{key:o,value:r.evaluateExpression(c)}),s===n&&j(e,o)&&w(e,r,c),r.onChangeExpressionChain(c,(()=>{A(e,{key:o,value:r.evaluateExpression(c)})}))))}))}function P(e){e.nodeType===Node.ELEMENT_NODE&&(e.removeAttribute("slot"),e.removeAttribute("hidden"))}function w(e,n,t){const o=e.tagName.toLowerCase();["input","textarea"].includes(o)?e.addEventListener("input",(a=>{const i=a.target;"input"===o&&"checkbox"===e.getAttribute("type")&&n.setChainValue(t,i.checked),"input"===o&&"file"===e.getAttribute("type")?n.setChainValue(t,Array.from(i.files)):n.setChainValue(t,i.value)})):"select"===o&&e.addEventListener("change",(e=>{n.setChainValue(t,e.target.value)}))}function N(e,n,t){if(!n.getChainValue(t))return;const o="input"===e.tagName.toLowerCase()&&"checkbox"===e.getAttribute("type")?"checked":"value";w(e,n,`${t}.${o}`)}function O(e,n){return Array.from(e.attributes).some((e=>e.nodeName===n))}function E(e,n){return e.filter((e=>e.getAttribute("slot")===n))}function C(e,n){return E(e,n).map((e=>e.outerHTML)).join("")}function H(e){for(;e.children.length>0;)e.children[0].remove()}function I(e){for(;e.childNodes.length>0;)e.childNodes[0].remove()}function L(...e){return e.filter((e=>null!=e)).filter(String).join(".")}function V(e){return!e.disableTranslations&&r()}async function W(e){try{return await $(e.getRoutingStateEvent)}catch(e){return console.error('Routing configuration can not be obtained from "webc-app-loader"!\n',e),null}}function S(e,n,t){const o=n.getChainValue(t);if(o){for(const[n,t]of Object.entries(o))A(e,{key:n,value:t});if(!0===o._saveElement){for(const n in e)"function"==typeof e[n]&&(e[n]=e[n].bind(e));o.getElement||n.setChainValue(t,Object.assign(Object.assign({},o),{getElement:()=>e}))}}if(n.hasExpression(t)){const o=n.evaluateExpression(t);for(const[n,t]of Object.entries(o))A(e,{key:n,value:t})}}function U(e){return e.nodeType===Node.ELEMENT_NODE}function q(e){return e.nodeType===Node.TEXT_NODE&&e.nodeValue&&e.nodeValue.trim()}function B(e,o,a,i=null){if(t.includes(e.nodeName.toLowerCase()))return;if(e.nodeType!==Node.TEXT_NODE||!e.nodeValue||!e.nodeValue.trim())return;const r=[...e.nodeValue.matchAll(/\{\{\s*([^\s}}]+)\s*\}\}/g)];if(!r.length)return;const s=r.map((e=>({expression:e[0],chainWithPrefix:e[1]}))).filter((({chainWithPrefix:e})=>e.startsWith(n)||e.startsWith(d))).map((e=>{let{chainWithPrefix:t}=e;const r=t.startsWith(d);let s=e.chainWithPrefix.slice(1);!r&&i&&(s=L(i,s),t=`${n}${s}`);const l=r?a:o;return Object.assign(Object.assign({},e),{chain:s,isTranslation:r,isModel:!r,isModelExpression:l.hasExpression(s),evaluateModelExpression:()=>l.evaluateExpression(s),model:l,getChainValue:()=>{let e=l.getChainValue(s);if(r&&void 0===e){const{pathname:n}=window.location,t=m();console.warn(`No translations found for skin "${t}", page "${n}" and chain "${s}"`),e=s}return e}})}));if(!s.length)return;const l=e.nodeValue,c=()=>{let n=l;s.forEach((({expression:e,getChainValue:t,isModelExpression:o,evaluateModelExpression:a})=>{let i=t();["number","boolean"].includes(typeof i)&&(i=i.toString()),!i&&o&&(i=o?a():""),n=n.replace(e,i||"")})),e.nodeValue=n};c(),s.filter((e=>e.isModel)).forEach((({model:e,chain:n,isModelExpression:t})=>{e.onChange(n,(()=>{c()})),t&&e.onChangeExpressionChain(n,(()=>{c()}))}))}const D={bindElement:(e,r={model:null,translationModel:null})=>{const{model:m,translationModel:$,chainPrefix:k,enableTranslations:A=!1,recursive:j=!1}=r;if(m){if(q(e))B(e,m,$,k);else if(U(e)){const w=e;if(t.includes(w.tagName.toLowerCase()))return;if(w.hasAttribute(y)){let e;w.hasAttribute(i)&&(e=w.getAttribute(i),(null==e?void 0:e.startsWith(n))&&(e=e.slice(1)));const t=L(k,e);w[v]=()=>m.hasExpression(t)?m.evaluateExpression(t):m.toObject(t)}const C=O(w,h),H=O(w,s);if(C&&H)console.error("Cannot use both data-if and data-for attributes on the same element",w);else if(C)!function(e,t,{model:o,translationModel:a,chainPrefix:i,enableTranslations:r=!1}={model:null,translationModel:null}){let s=e.getAttribute(h);if(!s.startsWith(n))return void console.warn(`Attribute "${h}" doesn't start with the chain prefix!`);s=s.slice(1);const l=L(i,s),c=Array.from(e.children);let u,f=E(c,p);const m=E(c,b);f.length||m.length||(f=Array.from(e.childNodes)),I(e);const y=async n=>{let s;if(n instanceof Promise)try{s=await n}catch(e){console.error("data-if condition promise failed",e),s=!1}else s=!!n;const l=u!==s;u=s,l&&(()=>{const n=u?f:m;I(e),n.forEach((n=>{const s=n.cloneNode(!0);P(s),e.appendChild(s),t(s,{model:o,translationModel:a,chainPrefix:i,enableTranslations:r,recursive:!0})}))})()};y(o.getChainValue(l)),T(e,o,n,i),r&&T(e,a,d,i),o.onChange(l,(()=>{y(o.getChainValue(l))})),o.hasExpression(l)&&(y(o.evaluateExpression(l)),o.onChangeExpressionChain(l,(()=>{y(o.evaluateExpression(l))})))}(w,D.bindElement,r);else if(H)!function(e,t,{model:o,translationModel:a,chainPrefix:i,enableTranslations:r=!1}={model:null,translationModel:null}){let h=e.getAttribute(s);if(!h.startsWith(n))return void console.warn(`Attribute "${s}" doesn't start with the chain prefix!`);h=h.slice(1);const p=L(i,h);let b=o.getChainValue(p);if(!Array.isArray(b))return void console.error(`Attribute "${s}" (${h}) must be a chain to an array in the model!`,e);let m=b.length;const y=(e.getAttribute(l)||"").split(" ").filter(String),v=y.includes(c);let x=y.includes(u);const $=[],k=[];for(;e.childNodes.length>0;){const n=e.childNodes[0];U(n)&&n.getAttribute("slot")===f?$.push(n):k.push(n),n.remove()}let A=[];const j=()=>{if(!m)return I(e),void $.forEach((n=>{const s=n.cloneNode(!0);P(s),e.appendChild(s),t(s,{model:o,translationModel:a,chainPrefix:i,enableTranslations:r,recursive:!0})}));if(x){const n=document.createElement(e.tagName),t=Array.prototype.slice.call(e.attributes);let o;for(;o=t.pop();)o.nodeName!==l&&n.setAttribute(o.nodeName,o.nodeValue);y.length>0&&n.setAttribute(l,y.join(" ")),e.insertAdjacentElement("afterend",n),e.remove(),e=n}b.forEach(((n,i)=>{const s=[];k.forEach((e=>{const n=e.cloneNode(!0),l=L(p,i);t(n,{model:o,translationModel:a,chainPrefix:l,enableTranslations:r,recursive:!0}),s.push(n)})),A[i]?s.forEach(((e,n)=>{document.createElement("div").appendChild(A[i][n].cloneNode(!0));const t=g(e),o=g(A[i][n]);M(t,o,A[i][n])})):(s.forEach((n=>{e.appendChild(n)})),A[i]=s)}));for(let e=m;e<A.length;e++)A[e].forEach((e=>{I(e),e.remove()}));A.splice(m)},w=(n,t=!1)=>{Array.isArray(n)||(console.error(`Attribute "${s}" must be an array in the model!`),n=[]);const o=m!==(n=n||[]).length;b=n,m=b.length,v?j():(t||o)&&(I(e),A=[],j())};j(),T(e,o,n,i),r&&T(e,a,d,i),o.onChange(p,(({targetChain:e})=>{const n=p===e;w(o.getChainValue(p),n)})),o.hasExpression(p)&&o.onChangeExpressionChain(p,(()=>{w(o.evaluateExpression(p))}))}(w,D.bindElement,r);else{const e=w.hasAttribute(a),t=w.hasAttribute(i);if(!w.hasAttribute(x)){if(e||t){let o;if(e?o=w.getAttribute(a):(console.warn(`Attribute "${i}" is deprecated for binding! Use the "${a}" key attribute instead.`,w),o=w.getAttribute(i)),o.startsWith(n)){o=o.slice(1);const e=L(k,o);w.setAttribute(a,`${n}${e}`),t&&w.setAttribute(i,`${n}${e}`),S(w,m,e),N(w,m,e),m.onChange(e,(()=>S(w,m,e))),m.hasExpression(e)&&m.onChangeExpressionChain(e,(()=>S(w,m,e)))}else console.warn(`Invalid chain found! (chain: "${o}")!\n`,`A valid chain must start with "${n}".\n`,"target element:",w)}w.tagName.startsWith(o.toUpperCase())||T(w,m,n,k),A&&T(w,$,d,k),Array.from(w.childNodes).filter(q).forEach((e=>{B(e,m,$,k)}))}j&&Array.from(w.children).forEach((e=>{D.bindElement(e,r)}))}}}else{const n=U(e)?e.tagName.toLowerCase():"text node";console.warn(`No model found for: ${n}!`)}},bindChildNodes:(e,n)=>{Array.from(e.childNodes).forEach((e=>{D.bindElement(e,Object.assign({},n))}))}};export{D as B,w as a,T as b,N as c,E as d,C as e,H as f,k as g,I as h,O as i,L as j,V as k,W as l,P as r,A as s}