import{r as t,c as s,h as i}from"./p-751bf9a8.js";import{H as o}from"./p-3693c2fd.js";import{a as h,f as e,b as r}from"./p-5b88ecac.js";import{C as a}from"./p-4386e5ef.js";import{B as c,r as n}from"./p-c2bba7e7.js";import{e as f}from"./p-e6bd91d6.js";import{p as l}from"./p-794858b0.js";import{c as m,d as p}from"./p-0c3518a5.js";const d=class{constructor(i){t(this,i),this.getModelEvent=s(this,"webcardinal:model:get",7),this.getTranslationModelEvent=s(this,"webcardinal:translationModel:get",7),this.chain="",this.autoBind=!1,this.template=[],this.noDatatemplate=[],this.existingNodes=[],this.bindRelativeModel=(t,s)=>{const i=t.tagName.toLowerCase();if(h.includes(i))return;const o=[this.chain.slice(1),s].join(".");c.bindElement(t,{model:this.model,translationModel:this.translationModel,recursive:!0,enableTranslations:!0,chainPrefix:o})}}_handleTemplate(){const t=this.chain.slice(1),s=()=>{if(!this.model)return;const s=this.model.getChainValue(t);if(Array.isArray(s)){s.length||this.noDatatemplate.forEach((t=>{const s=t.cloneNode(!0);n(s),this.host.appendChild(s),this.bindRelativeModel(s,"")}));for(let t=0;t<s.length;t++){const s=[];for(const i of this.template){const o=i.cloneNode(!0);this.bindRelativeModel(o,t),s.push(o)}s.forEach(this.existingNodes[t]?(s,i)=>{const o=document.createElement("div");o.appendChild(s);const h=document.createElement("div");h.appendChild(this.existingNodes[t][i].cloneNode(!0));const e=m(o),r=m(h);p(e,r,this.existingNodes[t][i])}:t=>{this.host.appendChild(t)}),this.existingNodes[t]=s}}else console.error(`Attribute "${r}" must be an array in the model!`)};s(),this.model.onChange(t,(()=>{s()})),this.model.hasExpression(t)&&this.model.onChangeExpressionChain(t,(()=>{s()}))}async componentWillLoad(){if(this.host.isConnected){if(this.chain=f(this.host),"string"==typeof this.controllerName)try{const t=await a.getController(this.controllerName);this.host.isConnected&&(this.controller=new t(this.host,this.history),this.controller.model&&(this.model=this.controller.model),this.controller.translationModel&&(this.translationModel=this.controller.translationModel))}catch(t){console.error(t)}else try{this.model=await l(this.getModelEvent),this.translationModel=await l(this.getTranslationModelEvent)}catch(t){console.error(t)}for(;this.host.children.length>0;){const t=this.host.children[0];t.getAttribute("slot")===e?this.noDatatemplate.push(t):this.template.push(t),t.remove()}this._handleTemplate()}}render(){return i("slot",null)}};!function(t,s,i,o){var h,e=arguments.length,r=e<3?s:null===o?o=Object.getOwnPropertyDescriptor(s,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,s,i,o);else for(var a=t.length-1;a>=0;a--)(h=t[a])&&(r=(e<3?h(r):e>3?h(s,i,r):h(s,i))||r);e>3&&r&&Object.defineProperty(s,i,r)}([o()],d.prototype,"host",void 0);export{d as webc_for}