import{g as e}from"./p-a9ce478c.js";import{d as t,b as n}from"./p-a74cad87.js";function o(e){return null!==e&&"string"==typeof e&&!!e.startsWith("@")&&e.length>=1}function i(e,n,i){return!!o(n)&&void 0===i[t(e)]&&"view-model"!==e}function r(e,t){switch(e){case"attr":return function(e,n){this.setAttribute(e,t.getChainValue(n))};default:return function(e,n){let o=t.getChainValue(n);this[e]=Array.isArray(this[e])?[...o]:o}}}function l(e,t){this.createBoundedModel=function(o,i){return i=n(i),t.onChange(i,(()=>{e(o,i)})),e(o,i),{updateModel:e=>{t.setChainValue(i,e)}}}}function s(e,t,o){let{properties:i,hasViewModel:s,instanceName:a}=t;e.dispatchEvent(new CustomEvent("getModelEvent",{bubbles:!0,composed:!0,detail:{callback:(t,c)=>{let u;t&&console.error(t);let p={};const f=t=>{if(!p[t]){let n="attr"===i[t].type?e:this,o=new l(r.call(n,i[t].type,c).bind(n),c);p[t]=o.createBoundedModel(t,i[t].value)}},d=()=>{for(let e in i)f(e)};if(s){u=e.getAttribute("view-model"),u=n(u);const t=()=>{let e=c.getChainValue(u);for(let t in e)i[t]||(i[t]={value:u?u+"."+t:t,type:"prop"})};t(),c.onChange(u,(()=>{t(),d()}))}if(d(),void 0!==this[a])throw new Error(`BindModel decorator received a wrong argument as instance name: [${a}]`);this[a]={updateModel:(e,t)=>{i[e]||(i[e]={value:u?u+"."+e:e,type:"prop"},f(e)),p[e].updateModel(t)}},o()}}}))}function a(){return(t,n)=>{let{componentWillLoad:r}=t;t.componentWillLoad=function(){let t=this.__proto__,l=this,a=e(l),c=e=>e?new Promise((t=>{e.then((()=>{t(r&&r.call(l))}))})):r&&r.call(l);if(a.isConnected){let e=Object.keys(t),r=a.getAttributeNames(),u={};for(let t=0;t<e.length;t++){let n=e[t];o(this[n])&&(u[n]={value:this[n],type:"prop"})}for(let e=0;e<r.length;e++){let t=r[e],n=a.getAttribute(t);i(t,n,u)&&(u[t]={value:n,type:"attr"})}let p=a.hasAttribute("view-model");if(Object.keys(u).length>0||p)return c(new Promise((e=>{s.call(l,a,{properties:u,hasViewModel:p,instanceName:n},e)})))}return c()}}}export{a as B}